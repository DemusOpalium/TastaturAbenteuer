<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title data-translate="title">Schreibabenteuer DemusOpalium</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@700&family=Roboto:wght@400;700&family=Merriweather:wght@400;700&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
  <!-- Animate.css f√ºr Animationen -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
    /* Basis-Reset */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    /* Grundlayout und Themes */
    body {
      font-family: 'Roboto', sans-serif;
      transition: background 0.5s ease, color 0.5s ease;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    /* Vorhandene Themes */
    .theme-dark { background: linear-gradient(135deg, #2c3e50, #4ca1af); color: #f0f0f0; }
    .theme-light { background: #f7f7f7; color: #333; }
    .theme-vintage { background: #f4e8c1; color: #5a4b3b; }
    /* Neue Themes */
    .theme-neon { background: #0f0f0f; color: #39ff14; }
    .theme-pastel { background: #ffe6f0; color: #ff8fa3; }
    .theme-ocean { background: #1e3d59; color: #a2d5f2; }
    .theme-forest { background: #2d4739; color: #cdeac0; }
    .theme-sunset { background: #ff9a8d; color: #4b134f; }
    /* Rahmen f√ºr Buttons, Selects und Labels */
    .theme-dark button, .theme-dark select, .theme-dark label { border: 1px solid #444; }
    .theme-light button, .theme-light select, .theme-light label { border: 1px solid #ccc; }
    .theme-vintage button, .theme-vintage select, .theme-vintage label { border: 1px solid #a67c52; }
    .theme-neon button, .theme-neon select, .theme-neon label { border: 1px solid #39ff14; }
    .theme-pastel button, .theme-pastel select, .theme-pastel label { border: 1px solid #ff8fa3; }
    .theme-ocean button, .theme-ocean select, .theme-ocean label { border: 1px solid #a2d5f2; }
    .theme-forest button, .theme-forest select, .theme-forest label { border: 1px solid #cdeac0; }
    .theme-sunset button, .theme-sunset select, .theme-sunset label { border: 1px solid #4b134f; }
    /* √úberschrift */
    .title {
      font-family: 'Lora', serif;
      font-size: 2.5em;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
      text-transform: uppercase;
    }
    /* Profilbereich */
    #profileContainer {
      width: 100%;
      max-width: 800px;
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    #profileImage {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #ccc;
      object-fit: cover;
      border: 2px solid #fff;
    }
    #profileDetails { flex: 1; color: inherit; }
    #profileDetails h3, #profileDetails p { margin: 3px 0; }
    /* Rang-Badge im Profilbereich */
    .rank-badge {
      background: gold;
      color: #000;
      padding: 3px 6px;
      border-radius: 4px;
      font-weight: bold;
      margin-left: 8px;
      font-size: 0.8em;
    }
    /* Shopbereich */
    #shopContainer {
      width: 100%;
      max-width: 800px;
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
    }
    #shopContainer h2 { margin-bottom: 10px; }
    #shopContainer button {
      margin: 5px;
      padding: 5px 10px;
      font-size: 0.9em;
      border-radius: 5px;
      background: rgba(255,255,255,0.2);
      color: inherit;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    #shopContainer button:hover { background: rgba(255,255,255,0.4); }
    /* Refresh-Buttons im Shop */
    #shopContainer .refresh-btn {
      margin-top: 10px;
      background: #0077cc;
      color: #fff;
      border: none;
    }
    #shopContainer .refresh-btn:hover { background: #005fa3; }
    /* Inventarbereich */
    #inventoryContainer {
      width: 100%;
      max-width: 800px;
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    #inventoryContainer h2 { text-align: center; margin-bottom: 10px; }
    #inventoryContainer div { margin-bottom: 10px; }
    #inventoryContainer img { margin: 5px; border: 2px solid #fff; border-radius: 4px; cursor: pointer; }
    /* Info Button & Modal */
    #infoBtn {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      padding: 10px;
      font-size: 1.5em;
      cursor: pointer;
      transition: background 0.3s ease;
      z-index: 100;
    }
    #infoBtn:hover { background: rgba(255,255,255,0.4); }
    .modal {
      display: none;
      position: fixed;
      z-index: 200;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #fff;
      color: #333;
      padding: 20px;
      border-radius: 8px;
      max-width: 600px;
      width: 90%;
      text-align: left;
      font-family: 'Roboto', sans-serif;
    }
    .close-btn {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close-btn:hover { color: #000; }
    /* Dropdowns & Buttons */
    .design-controls, .extra-controls {
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .design-controls select, .extra-controls select, .extra-controls button {
      padding: 10px;
      font-size: 1em;
      border-radius: 5px;
      background: rgba(255,255,255,0.2);
      color: inherit;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .design-controls select:hover, .extra-controls select:hover, .extra-controls button:hover {
      background: rgba(255,255,255,0.4);
    }
    /* Statusleiste */
    .status-bar {
      margin-bottom: 15px;
      font-size: 1.1em;
      background: rgba(0,0,0,0.3);
      padding: 10px 15px;
      border-radius: 5px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    .status-item { min-width: 100px; text-align: center; }
    #copyScoreDisplay { display: none; }
    /* Schreibbereich */
    #writeArea {
      width: 100%;
      max-width: 800px;
      height: 300px;
      background: rgba(255,255,255,0.1);
      color: inherit;
      padding: 15px;
      border: 2px solid;
      border-radius: 8px;
      outline: none;
      overflow-y: auto;
      font-size: 1.1em;
      line-height: 1.5em;
      transition: background 0.3s ease;
    }
    .theme-dark #writeArea { border-color: #444; }
    .theme-light #writeArea { border-color: #ccc; }
    .theme-vintage #writeArea { border-color: #a67c52; }
    .theme-neon #writeArea { border-color: #39ff14; }
    .theme-pastel #writeArea { border-color: #ff8fa3; }
    .theme-ocean #writeArea { border-color: #a2d5f2; }
    .theme-forest #writeArea { border-color: #cdeac0; }
    .theme-sunset #writeArea { border-color: #4b134f; }
    #writeArea.warning { background: rgba(200,50,50,0.5); animation: shake 0.5s infinite alternate; }
    @keyframes shake { from { transform: translateX(0); } to { transform: translateX(3px); } }
    /* Copy Challenge */
    #copyTarget {
      display: none;
      border: 2px solid #000;
      background: #fff;
      color: #000;
      padding: 10px;
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 10px;
      border-radius: 5px;
    }
    #targetSentence { font-weight: bold; }
    /* Steuerungselemente */
    .controls {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .controls label, .controls select, .controls button {
      padding: 10px 15px;
      font-size: 1em;
      border-radius: 5px;
      background: rgba(255,255,255,0.2);
      color: inherit;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .controls button:hover, .controls select:hover, .controls label:hover {
      background: rgba(255,255,255,0.4);
    }
    /* Boss-Anzeige */
    #bossContainer { display: none; margin-top: 10px; text-align: center; }
    #bossName { font-size: 1.2em; font-weight: bold; margin-bottom: 5px; }
    #bossHealthBar {
      background: red;
      width: 300px;
      height: 20px;
      border-radius: 10px;
      overflow: hidden;
      margin: 0 auto;
    }
    #bossHealth {
      background: green;
      width: 100%;
      height: 100%;
      transition: width 0.5s ease;
    }
    /* Achievement-Popup */
    .achievement {
      margin-top: 20px;
      padding: 15px;
      background: rgba(255,215,0,0.8);
      border-radius: 8px;
      font-size: 1.2em;
      font-weight: bold;
      color: #333;
      display: none;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    /* Erfolge & Belohnungen */
    .achievements-rewards-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      max-width: 800px;
      width: 100%;
      margin-top: 20px;
    }
    .achievements-section, .rewards-section {
      flex: 1 1 380px;
      background: rgba(0,0,0,0.3);
      padding: 15px;
      border-radius: 8px;
    }
    .achievements-section h2, .rewards-section h2 { text-align: center; margin-bottom: 10px; }
    .achievement-filters {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .achievement-filters label { font-size: 0.9em; }
    .achievement-filters select { padding: 5px; font-size: 0.9em; }
    #achievementTable {
      width: 100%;
      border-collapse: collapse;
    }
    #achievementTable th, #achievementTable td {
      padding: 8px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    #achievementTable th { background: rgba(255,255,255,0.2); }
    /* Leaderboard */
    .leaderboard {
      margin-top: 20px;
      max-width: 800px;
      width: 100%;
      background: rgba(0,0,0,0.3);
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
    }
    .leaderboard table {
      width: 100%;
      border-collapse: collapse;
    }
    .leaderboard th, .leaderboard td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .leaderboard th { background: rgba(255,255,255,0.2); }
    /* End Session Popup */
    #endSessionPopup {
      display: none;
      position: fixed;
      z-index: 300;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      color: #333;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      text-align: center;
      max-width: 90%;
    }
    #endSessionPopup button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      border-radius: 5px;
      border: none;
      background: #0077cc;
      color: #fff;
      transition: background 0.3s ease;
    }
    #endSessionPopup button:hover { background: #005fa3; }
    /* CSS Animation f√ºr W√ºrfel-Popup */
    .dice-animation {
      animation: rollDice 0.5s ease-in-out;
    }
    @keyframes rollDice {
      0% { transform: rotate(0deg); }
      50% { transform: rotate(180deg); }
      100% { transform: rotate(360deg); }
    }
    .fade-out {
      animation: fadeOut 1s forwards;
    }
    @keyframes fadeOut {
      to { opacity: 0; }
    }
    /* Responsive Layout */
    @media (max-width: 600px) {
      #writeArea { height: 250px; }
      .status-bar, .controls, .design-controls, .extra-controls, .achievements-rewards-container {
        flex-direction: column;
      }
      #profileContainer { flex-direction: column; align-items: center; }
    }
    /* Button f√ºr Sprachumschaltung */
    #langBtn {
      position: fixed;
      top: 10px;
      left: 10px;
      padding: 5px 10px;
      font-size: 1em;
      cursor: pointer;
      z-index: 300;
    }
  </style>
</head>
<body class="theme-dark">
  <!-- Sprachumschalt-Button -->
  <button id="langBtn" onclick="toggleLanguage()">EN</button>

  <!-- Profilbereich -->
  <div id="profileContainer">
    <img id="profileImage" src="https://via.placeholder.com/80" alt="Profilbild">
    <div id="profileDetails">
      <h3 id="playerName" data-translate="playerName">Spielername</h3>
      <p id="playerRank" data-translate="playerRank">Rang: <span class="rank-badge">Bronze</span></p>
      <p id="playerWissenspunkte" data-translate="playerPoints">Wissenspunkte: 0</p>
    </div>
  </div>

  <!-- Namens√§nderung -->
  <div id="nameChangeContainer">
    <input type="text" id="playerNameInput" data-translate-placeholder="newNamePlaceholder" placeholder="Neuen Namen eingeben">
    <button id="changeNameBtn" data-translate="changeNameBtn">Namen √§ndern</button>
  </div>
  
  <!-- Shopbereich -->
  <div id="shopContainer">
    <h2 data-translate="shopTitle">Shop</h2>
    <div id="shopProfileSection"></div>
    <div id="shopGluecksbringerSection"></div>
    <button class="refresh-btn" onclick="refreshProfile()" data-translate="profileRefresh">Profil Refresh</button>
    <button class="refresh-btn" onclick="refreshGluecksbringer()" data-translate="gluecksbringerRefresh">Gl√ºcksbringer Refresh</button>
  </div>
  
  <!-- Inventarbereich -->
  <div id="inventoryContainer">
    <h2 data-translate="inventoryTitle">Inventar</h2>
    <!-- Inventar wird dynamisch gerendert -->
  </div>
  
  <!-- Info Button & Modal -->
  <button id="infoBtn">‚ÑπÔ∏è</button>
  <div id="infoModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="closeInfo">&times;</span>
      <h2 style="color: #0077cc;" data-translate="infoTitle">Willkommen bei Schreibabenteuer DemusOpalium! ‚ú®</h2>
      <p>
        <strong data-translate="infoOverviewTitle">üìú √úberblick:</strong><br>
        <span data-translate="infoOverview">
          Schreibe in variablen Zeitmodi (1‚Äì5 Minuten) spannende Challenges ‚Äì egal ob Freewrite, Adventure, Copy Challenge oder Hardcore. Nur Tippen, kein Kopieren!
        </span>
      </p>
      <p>
        <strong data-translate="infoModesTitle">üöÄ Modi:</strong><br>
        <span data-translate="infoModes">
          Freewrite, Adventure (gegen den Wort-Boss), Copy Challenge und Hardcore.
        </span>
      </p>
      <p>
        <strong data-translate="infoNoticeTitle">‚ö†Ô∏è Hinweis:</strong><br>
        <span data-translate="infoNotice">
          Copy-Paste ist verboten! Schummeln gibt‚Äòs nicht!
        </span>
      </p>
      <p>
        <strong data-translate="infoRewardsTitle">üéâ Belohnungen & Erfolge:</strong><br>
        <span data-translate="infoRewards">
          Schalte Erfolge frei und erhalte coole Rewards ‚Äì dein Fortschritt wird gespeichert!
        </span>
      </p>
    </div>
  </div>
  
  <!-- √úberschrift -->
  <div class="title" data-translate="title">Schreibabenteuer DemusOpalium</div>
  
  <!-- Design & Extra Controls -->
  <div class="design-controls">
    <label for="themeSelect" data-translate="chooseTheme">Theme w√§hlen:</label>
    <select id="themeSelect">
      <option value="theme-dark" selected>Dark</option>
      <option value="theme-light">Light</option>
      <option value="theme-vintage">Vintage</option>
      <option value="theme-neon">Neon</option>
      <option value="theme-pastel">Pastel</option>
      <option value="theme-ocean">Ocean</option>
      <option value="theme-forest">Forest</option>
      <option value="theme-sunset">Sunset</option>
    </select>
    <label for="fontSelect" data-translate="chooseFont">Schriftart w√§hlen:</label>
    <select id="fontSelect">
      <option value="'Roboto', sans-serif" selected>Roboto</option>
      <option value="'Lora', serif">Lora</option>
      <option value="'Merriweather', serif">Merriweather</option>
      <option value="'Open Sans', sans-serif">Open Sans</option>
      <option value="'Courier New', monospace">Courier New</option>
    </select>
  </div>
  <div class="extra-controls">
    <label for="difficultySelect" data-translate="difficulty">Schwierigkeitsgrad:</label>
    <select id="difficultySelect">
      <option value="easy" selected>Einfach</option>
      <option value="normal">Normal</option>
      <option value="hard">Schwer</option>
    </select>
    <label for="librarySelect" data-translate="category">Kategorie:</label>
    <select id="librarySelect">
      <option value="standard" selected>Standard</option>
      <option value="realschule">Realschule</option>
      <option value="gymnasium">Gymnasium</option>
      <option value="medizin">Medizin</option>
      <option value="bank">Bank</option>
      <option value="tierwelt">Tierwelt</option>
      <option value="code_python">Code/Python</option>
    </select>
    <button id="shareBtn" data-translate="shareResults">Ergebnisse Teilen</button>
    <button id="saveProfileBtn" data-translate="saveProfile">Profil Speichern</button>
    <button id="loadProfileBtn" data-translate="loadProfile">Profil Laden</button>
    <input type="file" id="loadProfileInput" style="display:none;" accept=".txt, .json">
  </div>
  
  <!-- Statusleiste -->
  <div class="status-bar">
    <div class="status-item" id="timer" data-translate="time">Time: 01:00</div>
    <div class="status-item" id="wordCount" data-translate="words">Words: 0</div>
    <div class="status-item" id="goalProgress" data-translate="goal">Goal: 0/100</div>
    <div class="status-item" id="xpDisplay" data-translate="xp">XP: 0</div>
    <div class="status-item" id="levelDisplay" data-translate="level">Level: 1</div>
    <div class="status-item" id="wpmDisplay" data-translate="wpm">WPM: 0</div>
    <div class="status-item" id="apmDisplay" data-translate="apm">APM: 0</div>
    <div class="status-item" id="hotStreakIndicator" data-translate="hotStreak">HOT STREAK!</div>
    <div class="status-item" id="copyScoreDisplay" style="display:none;" data-translate="copyScore">Copy Score: 0</div>
  </div>
  
  <!-- Steuerungselemente -->
  <div class="controls">
    <label for="modeSelect" data-translate="mode">Modus:</label>
    <select id="modeSelect">
      <option value="free" data-translate="freeMode">Freewrite (keine Strafe)</option>
      <option value="hardcore" data-translate="hardcoreMode">Hardcore (Text l√∂schen)</option>
      <option value="creative" data-translate="creativeMode">Kreativ (mit Schreibimpuls)</option>
      <option value="adventure" data-translate="adventureMode">Adventure (Boss &amp; EPIC)</option>
      <option value="copy" data-translate="copyMode">Copy Challenge</option>
    </select>
    <label for="timeSelect" data-translate="timeMode">Zeitmodus:</label>
    <select id="timeSelect">
      <option value="1">1 Minute</option>
      <option value="2">2 Minuten</option>
      <option value="3">3 Minuten</option>
      <option value="4">4 Minuten</option>
      <option value="5" selected>5 Minuten</option>
    </select>
    <button id="startBtn" data-translate="prepareGame">Spiel vorbereiten</button>
    <button id="resetBtn" data-translate="reset">Reset</button>
    <button id="promptBtn" style="display:none;" data-translate="showPrompt">Schreibimpuls anzeigen</button>
  </div>
  
  <!-- Copy Challenge -->
  <div id="copyTarget" style="display:none;">&gt; <span id="targetSentence"></span></div>
  <button id="checkBtn" style="display:none;" data-translate="checkSentence">Satz pr√ºfen</button>
  
  <!-- Boss-Anzeige -->
  <div id="bossContainer" style="display:none;">
    <div id="bossName"></div>
    <div id="bossHealthBar"><div id="bossHealth"></div></div>
  </div>
  
  <!-- Schreibbereich -->
  <div id="writeArea" contenteditable="true" data-translate-placeholder="writePlaceholder" placeholder="Hier beginnen zu schreiben..."></div>
  
  <!-- Achievement-Popup -->
  <div class="achievement animate__animated" id="achievementPopup">Achievement unlocked! üéâ</div>
  
  <!-- Erfolge & Belohnungen -->
  <div class="achievements-rewards-container">
    <div class="achievements-section">
      <h2 data-translate="achievementsTitle">Erfolge</h2>
      <div class="achievement-filters">
        <label for="achievementCategoryFilter" data-translate="achievementCategory">Kategorie:</label>
        <select id="achievementCategoryFilter">
          <option value="all" data-translate="all">Alle</option>
          <option value="Freewrite">Freewrite</option>
          <option value="Adventure">Adventure</option>
          <option value="Copy">Copy Challenge</option>
          <option value="Hardcore">Hardcore</option>
          <option value="Allgemein">Allgemeine &amp; Langzeit</option>
          <option value="Kreativ">Kreativ</option>
        </select>
        <label for="achievementDifficultyFilter" data-translate="achievementDifficulty">Schwierigkeitsgrad:</label>
        <select id="achievementDifficultyFilter">
          <option value="all" data-translate="all">Alle</option>
          <option value="easy" data-translate="easy">Leicht</option>
          <option value="normal" data-translate="normal">Normal</option>
          <option value="hard" data-translate="hard">Schwer/Episch</option>
        </select>
      </div>
      <table id="achievementTable">
        <thead>
          <tr>
            <th data-translate="icon">Icon</th>
            <th data-translate="achievement">Erfolg</th>
            <th data-translate="condition">Bedingung</th>
            <th data-translate="status">Status</th>
          </tr>
        </thead>
        <tbody id="achievementBody">
          <!-- Dynamisch generierte Erfolge -->
        </tbody>
      </table>
    </div>
    <div class="rewards-section">
      <h2 data-translate="rewardsTitle">Belohnungen</h2>
      <ul id="rewardList"></ul>
    </div>
  </div>
  
  <!-- Leaderboard -->
  <div class="leaderboard">
    <h2 data-translate="leaderboardTitle">Highscore-Liste ‚≠ê</h2>
    <table id="leaderboardTable">
      <thead>
        <tr>
          <th data-translate="rank">Platz</th>
          <th data-translate="words">W√∂rter</th>
          <th data-translate="xp">XP</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody">
        <!-- Dynamisch bef√ºllte Zeilen -->
      </tbody>
    </table>
  </div>
  
  <!-- End Session Popup -->
  <div id="endSessionPopup" style="display:none;">
    <!-- Der Popup-Inhalt wird dynamisch bef√ºllt -->
  </div>
  
  <script>
    /* --- √úbersetzungs-Objekt --- */
    const translations = {
      "de": {
        "title": "Schreibabenteuer DemusOpalium",
        "playerName": "Spielername",
        "playerRank": "Rang:",
        "playerPoints": "Wissenspunkte:",
        "newNamePlaceholder": "Neuen Namen eingeben",
        "changeNameBtn": "Namen √§ndern",
        "shopTitle": "Shop",
        "profileRefresh": "Profil Refresh",
        "gluecksbringerRefresh": "Gl√ºcksbringer Refresh",
        "inventoryTitle": "Inventar",
        "infoTitle": "Willkommen bei Schreibabenteuer DemusOpalium! ‚ú®",
        "infoOverviewTitle": "üìú √úberblick:",
        "infoOverview": "Schreibe in variablen Zeitmodi (1‚Äì5 Minuten) spannende Challenges ‚Äì egal ob Freewrite, Adventure, Copy Challenge oder Hardcore. Nur Tippen, kein Kopieren!",
        "infoModesTitle": "üöÄ Modi:",
        "infoModes": "Freewrite, Adventure (gegen den Wort-Boss), Copy Challenge und Hardcore.",
        "infoNoticeTitle": "‚ö†Ô∏è Hinweis:",
        "infoNotice": "Copy-Paste ist verboten! Schummeln gibt‚Äòs nicht!",
        "infoRewardsTitle": "üéâ Belohnungen & Erfolge:",
        "infoRewards": "Schalte Erfolge frei und erhalte coole Rewards ‚Äì dein Fortschritt wird gespeichert!",
        "chooseTheme": "Theme w√§hlen:",
        "chooseFont": "Schriftart w√§hlen:",
        "difficulty": "Schwierigkeitsgrad:",
        "category": "Kategorie:",
        "shareResults": "Ergebnisse Teilen",
        "saveProfile": "Profil Speichern",
        "loadProfile": "Profil Laden",
        "time": "Time: 01:00",
        "words": "Words: 0",
        "goal": "Goal: 0/100",
        "xp": "XP: 0",
        "level": "Level: 1",
        "wpm": "WPM: 0",
        "apm": "APM: 0",
        "hotStreak": "HOT STREAK!",
        "copyScore": "Copy Score: 0",
        "mode": "Modus:",
        "freeMode": "Freewrite (keine Strafe)",
        "hardcoreMode": "Hardcore (Text l√∂schen)",
        "creativeMode": "Kreativ (mit Schreibimpuls)",
        "adventureMode": "Adventure (Boss & EPIC)",
        "copyMode": "Copy Challenge",
        "timeMode": "Zeitmodus:",
        "prepareGame": "Spiel vorbereiten",
        "reset": "Reset",
        "showPrompt": "Schreibimpuls anzeigen",
        "checkSentence": "Satz pr√ºfen",
        "achievementsTitle": "Erfolge",
        "achievementCategory": "Kategorie:",
        "achievementDifficulty": "Schwierigkeitsgrad:",
        "all": "Alle",
        "easy": "Leicht",
        "normal": "Normal",
        "hard": "Schwer/Episch",
        "icon": "Icon",
        "achievement": "Erfolg",
        "condition": "Bedingung",
        "status": "Status",
        "rewardsTitle": "Belohnungen",
        "leaderboardTitle": "Highscore-Liste ‚≠ê",
        "rank": "Platz",
        "writePlaceholder": "Hier beginnen zu schreiben..."
      },
      "en": {
        "title": "Writing Adventure DemusOpalium",
        "playerName": "Player Name",
        "playerRank": "Rank:",
        "playerPoints": "Knowledge Points:",
        "newNamePlaceholder": "Enter new name",
        "changeNameBtn": "Change Name",
        "shopTitle": "Shop",
        "profileRefresh": "Refresh Profile",
        "gluecksbringerRefresh": "Refresh Charm",
        "inventoryTitle": "Inventory",
        "infoTitle": "Welcome to Writing Adventure DemusOpalium! ‚ú®",
        "infoOverviewTitle": "üìú Overview:",
        "infoOverview": "Write exciting challenges in variable time modes (1‚Äì5 minutes) ‚Äì whether it's Freewrite, Adventure, Copy Challenge or Hardcore. Just type, no copying!",
        "infoModesTitle": "üöÄ Modes:",
        "infoModes": "Freewrite, Adventure (against the Word Boss), Copy Challenge and Hardcore.",
        "infoNoticeTitle": "‚ö†Ô∏è Notice:",
        "infoNotice": "Copy-paste is prohibited! No cheating allowed!",
        "infoRewardsTitle": "üéâ Rewards & Achievements:",
        "infoRewards": "Unlock achievements and receive cool rewards ‚Äì your progress will be saved!",
        "chooseTheme": "Choose Theme:",
        "chooseFont": "Choose Font:",
        "difficulty": "Difficulty:",
        "category": "Category:",
        "shareResults": "Share Results",
        "saveProfile": "Save Profile",
        "loadProfile": "Load Profile",
        "time": "Time: 01:00",
        "words": "Words: 0",
        "goal": "Goal: 0/100",
        "xp": "XP: 0",
        "level": "Level: 1",
        "wpm": "WPM: 0",
        "apm": "APM: 0",
        "hotStreak": "HOT STREAK!",
        "copyScore": "Copy Score: 0",
        "mode": "Mode:",
        "freeMode": "Freewrite (no penalty)",
        "hardcoreMode": "Hardcore (text deletion)",
        "creativeMode": "Creative (with writing prompt)",
        "adventureMode": "Adventure (Boss & EPIC)",
        "copyMode": "Copy Challenge",
        "timeMode": "Time Mode:",
        "prepareGame": "Prepare Game",
        "reset": "Reset",
        "showPrompt": "Show Writing Prompt",
        "checkSentence": "Check Sentence",
        "achievementsTitle": "Achievements",
        "achievementCategory": "Category:",
        "achievementDifficulty": "Difficulty:",
        "all": "All",
        "easy": "Easy",
        "normal": "Normal",
        "hard": "Hard/Epic",
        "icon": "Icon",
        "achievement": "Achievement",
        "condition": "Condition",
        "status": "Status",
        "rewardsTitle": "Rewards",
        "leaderboardTitle": "Highscore List ‚≠ê",
        "rank": "Rank",
        "writePlaceholder": "Start writing here..."
      }
    };

    // Aktuelle Sprache (Standard: Deutsch)
    let currentLanguage = 'de';

    // Aktualisiert alle Elemente mit √úbersetzungsschl√ºsseln
    function updateLanguage() {
      document.documentElement.lang = currentLanguage;
      document.title = translations[currentLanguage].title;
      document.querySelectorAll('[data-translate]').forEach(elem => {
        let key = elem.getAttribute('data-translate');
        if (translations[currentLanguage][key]) {
          elem.textContent = translations[currentLanguage][key];
        }
      });
      document.querySelectorAll('[data-translate-placeholder]').forEach(elem => {
        let key = elem.getAttribute('data-translate-placeholder');
        if (translations[currentLanguage][key]) {
          elem.placeholder = translations[currentLanguage][key];
        }
      });
      document.getElementById('langBtn').textContent = currentLanguage === 'de' ? 'EN' : 'DE';
    }

    // Wechselt die Sprache zwischen Deutsch und Englisch
    function toggleLanguage() {
      currentLanguage = currentLanguage === 'de' ? 'en' : 'de';
      updateLanguage();
    }
    updateLanguage();

    /* --- Restlicher JavaScript-Code --- */
    let timerInterval = null, idleTimeout = null;
    let sessionActive = false;
    let sessionStartTime = null;
    let remainingTime = 60;
    let keyPressCount = 0;
    let hotStreakCounter = 0;
    let lastKeyTime = 0;
    let hotStreakRequired = 20;
    let hotStreakTimeThreshold = 250;
    let waitingForStart = false;
    let copyScore = 0;
    let currentTargetSentence = "";

    let userStats = { 
      xp: 0,
      totalWords: 0,
      longestSession: 0,
      level: 1,
      playerName: "Spielername",
      wissenspunkte: 500,
      profileImage: "",
      inventory: {
        profileImages: [],
        gluecksbringer: []
      }
    };

    const availableProfileImages = [
      "https://i.imgur.com/2cqISZ8.png",
      "https://i.imgur.com/WCghhSg.png",
      "https://i.imgur.com/AG8MXbR.png",
      "https://i.imgur.com/67lln3j.png",
      "https://i.imgur.com/NUfCLza.png",
      "https://i.imgur.com/dyOkN0p.png",
      "https://i.imgur.com/At7GxhG.png"
    ];
    const availableGluecksbringer = [
      "https://i.imgur.com/Qg6no9G.png",
      "https://i.imgur.com/N74fFUp.png",
      "https://i.imgur.com/zrOdwI6.png",
      "https://i.imgur.com/3atajUk.png",
      "https://i.imgur.com/3PAQktM.png",
      "https://i.imgur.com/E3B6FT4.png",
      "https://i.imgur.com/PsEpoi4.png"
    ];
    const shopProfileItems = availableProfileImages.map((url, index) => {
      return { id: "Profilbild " + (index + 1), imgUrl: url, price: 150 + (index * 25) };
    });
    const shopGluecksbringerItems = availableGluecksbringer.map((url, index) => {
      return { id: "Gl√ºcksbringer " + (index + 1), imgUrl: url, price: 150 + (index * 25) };
    });
    const secretKey = "geheimerSchluessel123";
    function generateHash(input) {
      let hash = 0;
      for (let i = 0; i < input.length; i++) {
        const chr = input.charCodeAt(i);
        hash = ((hash << 5) - hash) + chr;
        hash |= 0;
      }
      return hash;
    }

    /* --- Copy-S√§tze --- */
    // Deutsche Satzbibliothek
    const sentenceLibraries = {
      standard: {
        easy: [
          "Der Hund l√§uft schnell.",
          "Die Sonne geht langsam unter."
        ],
        normal: [
          "Ein majest√§tischer Adler kreist hoch am azurblauen Himmel und inspiriert alle, die ihn beobachten.",
          "Die sanfte Ber√ºhrung eines k√ºhlen Windes bringt den Duft des Fr√ºhlings direkt in dein Herz."
        ],
        hard: [
          "Inmitten eines tobenden Sturms bahnt sich ein einsamer Held seinen Weg durch die √ºbers√§teten Tr√ºmmer der verlassenen Stadt, w√§hrend der Wind unerbittlich heult.",
          "Die synchronisierten Flugmuster eines Vogelschwarmes, die den Himmel in ein atemberaubendes Farbspektakel tauchen, demonstrieren die kollektive Intelligenz und den Zusammenhalt der Tierwelt."
        ]
      },
      realschule: {
        easy: [
          "Der Sch√ºler lernt t√§glich in der Realschule.",
          "Sch√ºler entwickeln ein tiefgreifendes Verst√§ndnis f√ºr Bildung."
        ],
        normal: [
          "Im Realschulunterricht werden theoretische Konzepte mit praxisnahen Anwendungen verkn√ºpft, um den Sch√ºlern ein umfassendes Verst√§ndnis zu vermitteln.",
          "Sch√ºler entwickeln ein tiefgreifendes Verst√§ndnis f√ºr die Bedeutung von Bildung als Grundlage f√ºr eine erfolgreiche Zukunft."
        ],
        hard: [
          "Die Realschule implementiert einen anspruchsvollen Lehrplan, der theoretische Konzepte mit praxisorientierten Projekten verkn√ºpft, um den Sch√ºlern ein fundiertes Verst√§ndnis komplexer Zusammenh√§nge zu vermitteln.",
          "Die enge Zusammenarbeit zwischen verschiedenen Fachbereichen f√∂rdert ein umfassendes Verst√§ndnis der globalen Zusammenh√§nge."
        ]
      },
      gymnasium: {
        easy: [
          "Der Sch√ºler liest ein anspruchsvolles Buch.",
          "Sch√ºler sch√§tzen die intellektuelle Atmosph√§re des Gymnasiums."
        ],
        normal: [
          "Im Gymnasium wird ein anspruchsvoller Lehrplan verfolgt, der klassische und moderne Bildungselemente miteinander verkn√ºpft.",
          "Durch kritische Reflexion eigener Lernprozesse wird die pers√∂nliche Weiterentwicklung kontinuierlich gef√∂rdert."
        ],
        hard: [
          "Im Gymnasium wird ein rigoroser Lehrplan verfolgt, der die Sch√ºler dazu anregt, tiefgreifende Analysen literarischer, historischer und naturwissenschaftlicher Ph√§nomene durchzuf√ºhren.",
          "Die Kombination aus empirischer Forschung und theoretischer Fundierung legt den Grundstein f√ºr ein nachhaltiges Bildungsverst√§ndnis."
        ]
      },
      medizin: {
        easy: [
          "Der Arzt untersucht den Patienten.",
          "Die Behandlung verl√§uft reibungslos."
        ],
        normal: [
          "In der modernen Klinik werden fortschrittliche Diagnoseverfahren eingesetzt, um die Gesundheit der Patienten pr√§zise zu beurteilen.",
          "Die Integration moderner IT-Systeme unterst√ºtzt die effiziente Verwaltung von Patientendaten."
        ],
        hard: [
          "In hochmodernen Forschungslabors werden neuartige therapeutische Ans√§tze entwickelt, die auf der pr√§zisen Analyse genetischer und molekularer Daten basieren.",
          "Die personalisierte Medizin revolutioniert die Behandlung schwerer Erkrankungen, indem sie individuelle genetische Profile in den Therapieprozess integriert."
        ]
      },
      bank: {
        easy: [
          "Der Kunde betritt die Bank.",
          "Der Service der Bank ist zuverl√§ssig und effizient."
        ],
        normal: [
          "Die Bank bietet ein breites Spektrum moderner Finanzdienstleistungen an, die sowohl traditionelle als auch digitale L√∂sungen umfassen.",
          "Durch den gezielten Einsatz modernster IT-Systeme werden alle Prozesse im Finanzwesen optimiert und transparent gestaltet."
        ],
        hard: [
          "In einem global vernetzten Finanzsystem nutzt die Bank fortschrittliche Analysemethoden, um komplexe Marktbewegungen pr√§zise zu prognostizieren und individuell zugeschnittene Anlageprodukte anzubieten.",
          "Durch den gezielten Einsatz modernster IT-Systeme werden alle Prozesse im Finanzwesen optimiert und transparent gestaltet, was das Kundenerlebnis verbessert."
        ]
      },
      tierwelt: {
        easy: [
          "Der Hund bellt im Garten.",
          "Die Antilope springt elegant √ºber das offene Feld."
        ],
        normal: [
          "In der afrikanischen Savanne demonstriert die Giraffe mit ihrem langen Gang und ihren eleganten Bewegungen eine beeindruckende Anpassungsf√§higkeit.",
          "Die synchronisierten Bewegungen eines Fischschwarms illustrieren ein beeindruckendes kollektives Verhalten, das weit √ºber das Individuum hinausgeht."
        ],
        hard: [
          "In den unendlichen Weiten der afrikanischen Savanne demonstriert die komplexe Sozialstruktur der Elefantenherde ein beeindruckendes Ma√ü an Kommunikation und Zusammenhalt.",
          "Die synchronisierten Flugmuster eines Vogelschwarmes, die den Himmel in ein atemberaubendes Farbspektakel tauchen, demonstrieren die kollektive Intelligenz und den Zusammenhalt der Tierwelt."
        ]
      },
      code_python: {
        easy: [
          "print('Hello, World!')",
          "message = 'Python rocks!'"
        ],
        normal: [
          "def add(x, y): return x + y",
          "def fibonacci(n):\n    a, b = 0, 1\n    for _ in range(n):\n        a, b = b, a + b\n    return a"
        ],
        hard: [
          "def complex_function(x):\n    return [i for i in range(x) if i % 2 == 0]\nprint(complex_function(10))",
          "try:\n    import non_existent_module\nexcept ImportError:\n    print('Modul nicht gefunden!')"
        ]
      }
    };

    // Englische Copy-S√§tze ‚Äì nur f√ºr ausgew√§hlte Kategorien (hier: standard und tierwelt ‚Üí animalworld)
    const sentenceLibraries_en = {
      standard: {
        easy: [
          "The dog runs fast.",
          "The sun sets slowly."
        ],
        normal: [
          "A majestic eagle soars high in the azure sky, inspiring everyone who watches it.",
          "The gentle caress of a cool breeze brings the scent of spring directly to your heart."
        ],
        hard: [
          "Amidst a raging storm, a lone hero makes his way through the scattered ruins of an abandoned city as the wind howls relentlessly.",
          "The synchronized flight patterns of a flock of birds, turning the sky into a breathtaking spectacle, demonstrate the collective intelligence and unity of the animal kingdom."
        ]
      },
      animalworld: {
        easy: [
          "The dog barks in the garden.",
          "The antelope jumps gracefully across the open field."
        ],
        normal: [
          "In the African savannah, the giraffe demonstrates impressive adaptability with its long stride and elegant movements.",
          "The synchronized movements of a school of fish illustrate a remarkable collective behavior that transcends the individual."
        ],
        hard: [
          "Across the vast African plains, the complex social structure of an elephant herd showcases an impressive level of communication and unity.",
          "The coordinated flight of a flock of birds, turning the sky into a dazzling spectacle, exemplifies the collective intelligence and cohesion of the animal world."
        ]
      }
    };

    let boss = null, bossDefeated = false;
    let lastProcessedIndex = 0;
    let lastHotStreakWordCount = 0;
    
    function calculateSessionScore(words, errorCount, wpm, sessionDuration) {
      let baseScore = words * 10;
      let errorPenalty = errorCount * 5;
      let targetWPM = 40;
      let tempoBonus = (wpm > targetWPM) ? Math.round((wpm - targetWPM) * 2) : 0;
      let timeBonus = sessionDuration < 120 ? 20 : 0;
      let finalScore = baseScore + tempoBonus + timeBonus - errorPenalty;
      return finalScore > 0 ? finalScore : 0;
    }
    
    function getPlayerRank() {
      if (userStats.xp < 500) return "Bronze";
      if (userStats.xp < 1000) return "Silber";
      return "Gold";
    }
    
    function updateProfileUI() {
      const profileImgElem = document.getElementById("profileImage");
      const playerNameElem = document.getElementById("playerName");
      const playerWissenspunkteElem = document.getElementById("playerWissenspunkte");
      profileImgElem.src = userStats.profileImage || "https://via.placeholder.com/80";
      playerNameElem.innerHTML = `${userStats.playerName} <span class="rank-badge">${getPlayerRank()}</span>`;
      playerWissenspunkteElem.textContent = "Wissenspunkte: " + userStats.wissenspunkte;
    }
    
    function showSessionResults(words, wpm, apm, errorCount, sessionScore) {
      let rank = getPlayerRank();
      let bonusWissenspunkte = Math.round(sessionScore / 10);
      let resultHTML = `
        <h2>${currentLanguage === 'de' ? "Session beendet!" : "Session Ended!"}</h2>
        <p>${currentLanguage === 'de' ? "Spieler:" : "Player:"} ${userStats.playerName} ‚Äì ${currentLanguage === 'de' ? "Rang:" : "Rank:"} ${rank}</p>
        <p>${currentLanguage === 'de' ? "W√∂rter:" : "Words:"} ${words}</p>
        <p>${currentLanguage === 'de' ? "WPM:" : "WPM:"} ${wpm}</p>
        <p>${currentLanguage === 'de' ? "APM:" : "APM:"} ${apm}</p>
        <p>${currentLanguage === 'de' ? "Fehler:" : "Errors:"} ${errorCount}</p>
        <p>${currentLanguage === 'de' ? "Session Score:" : "Session Score:"} ${sessionScore}</p>
        <p>${currentLanguage === 'de' ? "Bonus Wissenspunkte:" : "Bonus Knowledge Points:"} ${bonusWissenspunkte}</p>
        <button onclick="closeResultsPopup()">${currentLanguage === 'de' ? "Schlie√üen" : "Close"}</button>
      `;
      endSessionPopup.innerHTML = resultHTML;
      endSessionPopup.style.display = "block";
    }
    
    function closeResultsPopup() {
      endSessionPopup.style.display = "none";
    }
    
    function rollBonus() {
      return Math.floor(Math.random() * (50 - 3 + 1)) + 3;
    }
    
    function checkHotStreakBonus() {
      const HOT_STREAK_THRESHOLD = 8;
      if (hotStreakCounter >= HOT_STREAK_THRESHOLD) {
        let bonus = rollBonus();
        showDicePopup(bonus);
        hotStreakCounter = 0;
        return bonus;
      }
      return 0;
    }
    
    function showDicePopup(bonus) {
      const dicePopup = document.createElement("div");
      dicePopup.innerHTML = `<div class="dice-animation">${bonus}</div>`;
      dicePopup.style.position = "fixed";
      dicePopup.style.top = "50%";
      dicePopup.style.left = "50%";
      dicePopup.style.transform = "translate(-50%, -50%)";
      dicePopup.style.background = "rgba(0,0,0,0.8)";
      dicePopup.style.color = "#fff";
      dicePopup.style.padding = "20px";
      dicePopup.style.borderRadius = "10px";
      dicePopup.style.fontSize = "2em";
      dicePopup.style.zIndex = "500";
      document.body.appendChild(dicePopup);
      setTimeout(() => {
        dicePopup.classList.add("fade-out");
        setTimeout(() => { document.body.removeChild(dicePopup); }, 1000);
      }, 2000);
    }
    
    function renderShop() {
      const shopProfileSection = document.getElementById("shopProfileSection");
      shopProfileSection.innerHTML = "<h3>Profilbilder</h3>";
      shopProfileItems.forEach(item => {
        const btn = document.createElement("button");
        btn.id = "shop_" + item.id;
        if (userStats.inventory.profileImages && userStats.inventory.profileImages.includes(item.imgUrl)) {
          btn.disabled = true;
          btn.innerHTML = `<img src="${item.imgUrl}" style="width:32px; vertical-align:middle;"> Gekauft`;
        } else {
          btn.innerHTML = `<img src="${item.imgUrl}" style="width:32px; vertical-align:middle;"> ${item.price} Wissenspunkte`;
          btn.onclick = () => purchaseItem(item, "profile");
        }
        shopProfileSection.appendChild(btn);
      });
      const shopGluecksbringerSection = document.getElementById("shopGluecksbringerSection");
      shopGluecksbringerSection.innerHTML = "<h3>Gl√ºcksbringer</h3>";
      shopGluecksbringerItems.forEach(item => {
        const btn = document.createElement("button");
        btn.id = "shop_" + item.id;
        if (userStats.inventory.gluecksbringer && userStats.inventory.gluecksbringer.includes(item.imgUrl)) {
          btn.disabled = true;
          btn.innerHTML = `<img src="${item.imgUrl}" style="width:32px; vertical-align:middle;"> Gekauft`;
        } else {
          btn.innerHTML = `<img src="${item.imgUrl}" style="width:32px; vertical-align:middle;"> ${item.price} Wissenspunkte`;
          btn.onclick = () => purchaseItem(item, "gluecksbringer");
        }
        shopGluecksbringerSection.appendChild(btn);
      });
    }
    
    function purchaseItem(item, type) {
      if (userStats.wissenspunkte >= item.price) {
        userStats.wissenspunkte -= item.price;
        if (type === "profile") {
          userStats.profileImage = item.imgUrl;
          userStats.inventory.profileImages = userStats.inventory.profileImages || [];
          if (!userStats.inventory.profileImages.includes(item.imgUrl)) {
            userStats.inventory.profileImages.push(item.imgUrl);
          }
          unlockReward(`Profilbild ${item.id} freigeschaltet!`);
        } else if (type === "gluecksbringer") {
          document.getElementById("writeArea").style.cursor = "url('" + item.imgUrl + "'), auto";
          userStats.inventory.gluecksbringer = userStats.inventory.gluecksbringer || [];
          if (!userStats.inventory.gluecksbringer.includes(item.imgUrl)) {
            userStats.inventory.gluecksbringer.push(item.imgUrl);
          }
          unlockReward(`Gl√ºcksbringer ${item.id} freigeschaltet!`);
        }
        updateProfileUI();
        renderInventory();
        renderShop();
        alert(`${item.id} wurde erfolgreich gekauft!`);
      } else {
        alert(currentLanguage === 'de' ? "Nicht gen√ºgend Wissenspunkte! Verdiene mehr XP und Wissenspunkte, indem du weiterschreibst." : "Not enough Knowledge Points! Earn more XP and points by writing.");
      }
    }
    
    function renderInventory() {
      const container = document.getElementById("inventoryContainer");
      container.innerHTML = "<h2>Inventar</h2>";
      let profileDiv = document.createElement("div");
      profileDiv.innerHTML = "<h3>Profilbilder</h3>";
      userStats.inventory.profileImages = userStats.inventory.profileImages || [];
      userStats.inventory.profileImages.forEach(imgUrl => {
        let img = document.createElement("img");
        img.src = imgUrl;
        img.style.width = "50px";
        img.style.marginRight = "5px";
        img.style.cursor = "pointer";
        img.title = "Klicke, um dieses Profilbild auszuw√§hlen";
        img.onclick = () => {
          userStats.profileImage = imgUrl;
          updateProfileUI();
          renderInventory();
        };
        profileDiv.appendChild(img);
      });
      container.appendChild(profileDiv);
      let gluecksbringerDiv = document.createElement("div");
      gluecksbringerDiv.innerHTML = "<h3>Gl√ºcksbringer</h3>";
      userStats.inventory.gluecksbringer = userStats.inventory.gluecksbringer || [];
      userStats.inventory.gluecksbringer.forEach(curUrl => {
        let img = document.createElement("img");
        img.src = curUrl;
        img.style.width = "50px";
        img.style.marginRight = "5px";
        img.style.cursor = "pointer";
        img.title = "Klicke, um diesen Gl√ºcksbringer auszuw√§hlen";
        img.onclick = () => {
          document.getElementById("writeArea").style.cursor = "url('" + curUrl + "'), auto";
        };
        gluecksbringerDiv.appendChild(img);
      });
      container.appendChild(gluecksbringerDiv);
    }
    
    function generateProfileChecksum(stats) {
      return generateHash(stats.wissenspunkte.toString() + JSON.stringify(stats.inventory.gluecksbringer) + secretKey);
    }

    function saveProfile() {
      const profileChecksum = generateHash(userStats.wissenspunkte.toString() + secretKey);
      userStats.profileChecksum = generateProfileChecksum(userStats);
      const data = JSON.stringify(userStats, null, 2);
      const blob = new Blob([data], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "profile.json";
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        URL.revokeObjectURL(url);
        a.remove();
      }, 100);
    }

    function loadProfile(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const loadedProfile = JSON.parse(e.target.result);
          const expectedChecksum = generateProfileChecksum(loadedProfile);
          if (loadedProfile.profileChecksum !== expectedChecksum) {
            alert("Profilpr√ºfung fehlgeschlagen! M√∂glicher Betrugsversuch!");
            return;
          }
          userStats = loadedProfile;
          updateXPAndLevelDisplay();
          updateProfileUI();
          renderInventory();
          renderShop();
          alert("Profil erfolgreich geladen.");
        } catch (error) {
          alert("Fehler beim Laden des Profils: " + error);
        }
      };
      reader.readAsText(file);
    }

    function updateXPAndLevelDisplay() {
      xpDisplay.textContent = `XP: ${userStats.xp}`;
      levelDisplay.textContent = `Level: ${userStats.level}`;
    }

    function checkLevelUp() {
      const newLevel = Math.floor(userStats.xp / 100) + 1;
      if (newLevel > userStats.level) {
        userStats.level = newLevel;
        alert(currentLanguage === 'de' ? `Level Up! Du bist jetzt Level ${newLevel}.` : `Level Up! You are now level ${newLevel}.`);
        userStats.wissenspunkte += 50;
        if (newLevel === 2) { unlockReward("üòÄ Emoji Profil"); }
        if (newLevel === 3) { unlockReward("üòé Cool Emoji"); }
        if (newLevel === 4) { unlockReward("üî• Hot Emoji"); }
        if (newLevel === 5) { unlockReward("üèÜ Champion Emoji"); }
      }
      updateXPAndLevelDisplay();
      updateProfileUI();
    }

    function saveSessionToLeaderboard() {
      const currentWords = countWords(writeArea.innerText);
      const sessionData = { words: currentWords, xp: userStats.xp, timestamp: Date.now() };
      leaderboard.push(sessionData);
      leaderboard.sort((a, b) => b.words - a.words);
      localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
    }

    function updateLeaderboard() {
      const leaderboardBody = document.getElementById("leaderboardBody");
      leaderboardBody.innerHTML = "";
      leaderboard.slice(0, 10).forEach((session, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${index + 1} ‚≠ê</td><td>${session.words} ‚úçÔ∏è</td><td>${session.xp} üèÜ</td>`;
        leaderboardBody.appendChild(row);
      });
    }

    function shareResults() {
      const summary = `${currentLanguage === 'de' ? "Schreibabenteuer DemusOpalium Ergebnisse:" : "Writing Adventure DemusOpalium Results:"}\n${currentLanguage === 'de' ? "W√∂rter:" : "Words:"} ${countWords(writeArea.innerText)}\n${currentLanguage === 'de' ? "XP:" : "XP:"} ${userStats.xp}\n${currentLanguage === 'de' ? "Level:" : "Level:"} ${userStats.level}`;
      navigator.clipboard.writeText(summary).then(() => { alert(currentLanguage === 'de' ? "Ergebnisse kopiert!" : "Results copied!"); });
    }

    function unlockReward(reward) {
      if (!unlockedRewards.includes(reward)) {
        unlockedRewards.push(reward);
        alert(currentLanguage === 'de' ? "Reward freigeschaltet: " + reward : "Reward unlocked: " + reward);
        localStorage.setItem("unlockedRewards", JSON.stringify(unlockedRewards));
        updateRewardUI();
      }
    }

    function updateRewardUI() {
      const rewardList = document.getElementById("rewardList");
      rewardList.innerHTML = "";
      unlockedRewards.forEach(r => {
        const li = document.createElement("li");
        li.textContent = r;
        rewardList.appendChild(li);
      });
    }

    /* --- Event Listener --- */
    document.getElementById("changeNameBtn").addEventListener("click", function() {
      const newName = document.getElementById("playerNameInput").value.trim();
      if (newName) {
        userStats.playerName = newName;
        updateProfileUI();
        alert(currentLanguage === 'de' ? "Name wurde ge√§ndert!" : "Name changed!");
      } else {
        alert(currentLanguage === 'de' ? "Bitte gib einen g√ºltigen Namen ein." : "Please enter a valid name.");
      }
    });

    document.getElementById("saveProfileBtn").addEventListener("click", saveProfile);
    document.getElementById("loadProfileBtn").addEventListener("click", () => { loadProfileInput.click(); });
    document.getElementById("loadProfileInput").addEventListener("change", loadProfile);

    document.getElementById("infoBtn").addEventListener("click", () => { document.getElementById("infoModal").style.display = "flex"; });
    document.getElementById("closeInfo").addEventListener("click", () => { document.getElementById("infoModal").style.display = "none"; });
    window.addEventListener("click", (event) => { 
      const infoModal = document.getElementById("infoModal");
      if (event.target === infoModal) { infoModal.style.display = "none"; }
    });
    document.getElementById("startBtn").addEventListener("click", () => { resetSession(); });
    document.getElementById("resetBtn").addEventListener("click", resetSession);
    document.getElementById("promptBtn").addEventListener("click", showRandomPrompt);
    document.getElementById("shareBtn").addEventListener("click", shareResults);
    document.getElementById("checkBtn").addEventListener("click", checkCopySentence);

    const modeSelect = document.getElementById("modeSelect");
    const timeSelect = document.getElementById("timeSelect");
    const difficultySelect = document.getElementById("difficultySelect");
    const writeArea = document.getElementById("writeArea");
    const timerDisplay = document.getElementById("timer");
    const wordCountDisplay = document.getElementById("wordCount");
    const goalProgressDisplay = document.getElementById("goalProgress");
    const xpDisplay = document.getElementById("xpDisplay");
    const levelDisplay = document.getElementById("levelDisplay");
    const wpmDisplay = document.getElementById("wpmDisplay");
    const apmDisplay = document.getElementById("apmDisplay");
    const hotStreakIndicator = document.getElementById("hotStreakIndicator");
    const achievementPopup = document.getElementById("achievementPopup");
    const copyTargetElem = document.getElementById("copyTarget");
    const targetSentenceElem = document.getElementById("targetSentence");
    const endSessionPopup = document.getElementById("endSessionPopup");
    let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
    let unlockedRewards = [];
    if (localStorage.getItem("unlockedRewards")) {
      unlockedRewards = JSON.parse(localStorage.getItem("unlockedRewards"));
      updateRewardUI();
    }
    let sessionAchievements = {};
    let copyAchieved = {};
    const prompts = [
      "Es war einmal ein geheimnisvoller Wald, in dem die Zeit stillzustehen schien...",
      "Als die Sonne hinter den Bergen verschwand, begann ein Abenteuer, das alles ver√§ndern sollte...",
      "Pl√∂tzlich ert√∂nte ein seltsames Ger√§usch, und niemand wusste, was als N√§chstes passieren w√ºrde...",
      "In einer Stadt, in der jeder Bewohner ein Geheimnis hatte, wurde ein unscheinbarer Brief gefunden..."
    ];
    const warningSound = new Audio('warning.mp3');
    
    function countWords(text) {
      return text.trim().split(/\s+/).filter(w => w.length > 0).length;
    }
    
    function updateTimerDisplay() {
      let min = Math.floor(remainingTime / 60);
      let sec = remainingTime % 60;
      timerDisplay.textContent = `Time: ${min}:${sec.toString().padStart(2, "0")}`;
    }
    
    function updateWordCount() {
      const text = writeArea.innerText;
      const count = countWords(text);
      wordCountDisplay.textContent = `Words: ${count}`;
      goalProgressDisplay.textContent = `Goal: ${count}/${window.baseTarget || "-"}`;
      if (modeSelect.value === "adventure" && boss) { updateBossStatus(); }
      if (modeSelect.value === "adventure" && boss) {
         if (count - lastHotStreakWordCount >= 8) {
             let bonus = rollBonus();
             boss.currentHealth = Math.max(boss.currentHealth - bonus, 0);
             updateBossUI();
             showDicePopup(bonus);
             lastHotStreakWordCount = count;
         }
      }
      for (let threshold in sessionAchievements) {
        if (count >= threshold && !sessionAchievements[threshold].achieved) {
          sessionAchievements[threshold].achieved = true;
          const achieveElem = document.getElementById("achieve" + threshold);
          if (achieveElem) { achieveElem.textContent = "Erreicht"; }
        }
      }
    }
    
    function updateWPM() {
      if (!sessionStartTime) return;
      const elapsedMinutes = (Date.now() - sessionStartTime) / 60000;
      const wpm = Math.round(countWords(writeArea.innerText) / elapsedMinutes);
      wpmDisplay.textContent = `WPM: ${wpm}`;
    }
    
    function updateAPM() {
      if (!sessionStartTime) return;
      const elapsedMinutes = (Date.now() - sessionStartTime) / 60000;
      const apm = elapsedMinutes > 0 ? Math.round(keyPressCount / elapsedMinutes) : 0;
      apmDisplay.textContent = `APM: ${apm} max`;
    }
    
    function resetIdleTimer() {
      clearTimeout(idleTimeout);
      let idleLimit = (difficultySelect.value === "easy") ? 3000 : (difficultySelect.value === "normal") ? 2000 : 1000;
      idleTimeout = setTimeout(triggerInactivityWarning, idleLimit);
      writeArea.classList.remove("warning");
    }
    
    function triggerInactivityWarning() {
      writeArea.classList.add("warning");
      playWarningSound();
      if (modeSelect.value === "hardcore") {
        setTimeout(() => {
          if (writeArea.classList.contains("warning")) {
            writeArea.innerText = "";
            updateWordCount();
          }
        }, 2000);
      }
    }
    
    function playWarningSound() {
      warningSound.play().catch(e => console.log("Sound konnte nicht abgespielt werden:", e));
    }
    
    function showRandomPrompt() {
      const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];
      writeArea.innerText = randomPrompt + "\n\n";
      updateWordCount();
    }
    
    function showAchievement(message) {
      achievementPopup.textContent = message;
      achievementPopup.style.display = "block";
      achievementPopup.classList.add("animate__bounceIn");
      setTimeout(() => {
        achievementPopup.classList.remove("animate__bounceIn");
        achievementPopup.style.display = "none";
      }, 3000);
    }
    
    function showHotStreakIndicator() {
      hotStreakIndicator.style.display = "block";
      hotStreakIndicator.classList.add("animate__flash");
      setTimeout(() => {
        hotStreakIndicator.classList.remove("animate__flash");
        hotStreakIndicator.style.display = "none";
      }, 2000);
      hotStreakCounter = 0;
    }
    
    /* --- Copy Challenge Funktionen --- */
    function generateCopySentence() {
      let lib = document.getElementById("librarySelect").value;
      let diff = difficultySelect.value;
      let sentences;
      // Falls Englisch und Kategorie "tierwelt" gew√§hlt, auf "animalworld" umstellen
      if (currentLanguage === 'en' && lib === 'tierwelt') {
        lib = 'animalworld';
      }
      if (currentLanguage === 'de') {
        sentences = sentenceLibraries[lib][diff];
      } else {
        sentences = sentenceLibraries_en[lib] ? sentenceLibraries_en[lib][diff] : sentenceLibraries[lib][diff];
      }
      let randomIndex = Math.floor(Math.random() * sentences.length);
      currentTargetSentence = sentences[randomIndex];
      targetSentenceElem.textContent = currentTargetSentence.trim();
      writeArea.innerText = "";
    }
    
    function checkCopySentence() {
      let userInput = writeArea.innerText.replace(/\n/g, " ").trim().toLowerCase();
      let target = currentTargetSentence.trim().toLowerCase();
      if (userInput === target) {
        let points = currentTargetSentence.split(" ").length * 10;
        copyScore += points;
        userStats.xp += points;
        userStats.wissenspunkte += points;
        showAchievement(currentLanguage === 'de' ? "Satz korrekt! +" + points + " Punkte." : "Sentence correct! +" + points + " points.");
        checkCopyAchievements();
        writeArea.innerText = "";
        updateCopyScoreDisplay();
        generateCopySentence();
      } else {
        showAchievement(currentLanguage === 'de' ? "Nicht exakt! Versuche es erneut." : "Not exactly! Try again.");
      }
    }
    
    function checkCopyAchievements() {
      if (copyScore >= 100 && !copyAchieved["100"]) {
         copyAchieved["100"] = true;
         showAchievement(currentLanguage === 'de' ? "Copy Challenge Bronze erreicht! (+100 Punkte)" : "Copy Challenge Bronze reached! (+100 points)");
         unlockReward("ü•â Copy-Challenge Bronze");
      }
      if (copyScore >= 200 && !copyAchieved["200"]) {
         copyAchieved["200"] = true;
         showAchievement(currentLanguage === 'de' ? "Copy Challenge Silber erreicht! (+200 Punkte)" : "Copy Challenge Silver reached! (+200 points)");
         unlockReward("ü•à Copy-Challenge Silber");
      }
      if (copyScore >= 300 && !copyAchieved["300"]) {
         copyAchieved["300"] = true;
         showAchievement(currentLanguage === 'de' ? "Copy Challenge Gold erreicht! (+300 Punkte)" : "Copy Challenge Gold reached! (+300 points)");
         unlockReward("ü•á Copy-Challenge Gold");
      }
    }
    
    function initCopyMode() {
      copyScore = 0;
      copyAchieved = {};
      generateCopySentence();
      copyTargetElem.style.display = "block";
      document.getElementById("checkBtn").style.display = "inline-block";
      document.getElementById("copyScoreDisplay").style.display = "block";
      writeArea.innerText = currentLanguage === 'de' ? "Dr√ºcke Enter, um das Spiel zu starten" : "Press Enter to start the game";
      waitingForStart = true;
      updateCopyScoreDisplay();
    }
    
    function updateCopyScoreDisplay() {
      document.getElementById("copyScoreDisplay").textContent = "Copy Score: " + copyScore;
    }
    
    function startSession() {
      endSessionPopup.style.display = "none";
      sessionActive = true;
      keyPressCount = 0;
      hotStreakCounter = 0;
      waitingForStart = false;
      let idleLimit = (difficultySelect.value === "easy") ? 3000 : (difficultySelect.value === "normal") ? 2000 : 1000;
      let thresholdTime = (difficultySelect.value === "easy") ? 250 : (difficultySelect.value === "normal") ? 200 : 150;
      hotStreakTimeThreshold = thresholdTime;
      idleTimeout = setTimeout(triggerInactivityWarning, idleLimit);
    
      const timeMode = parseInt(timeSelect.value);
      remainingTime = timeMode * 60;
      if (modeSelect.value !== "copy") {
        window.baseTarget = (difficultySelect.value === "easy") ? timeMode * 65 : (difficultySelect.value === "normal") ? timeMode * 85 : timeMode * 100;
        generateAchievements();
      } else {
        generateCopySentence();
      }
    
      if (modeSelect.value === "adventure") {
        initBoss();
        lastProcessedIndex = 0;
        lastHotStreakWordCount = countWords(writeArea.innerText);
      }
    
      updateTimerDisplay();
      updateWordCount();
      sessionStartTime = Date.now();
    
      timerInterval = setInterval(() => {
        remainingTime--;
        updateTimerDisplay();
        updateWPM();
        updateAPM();
        if (modeSelect.value === "adventure" && boss) { updateBossStatus(); }
        if (remainingTime <= 0) { 
          if (modeSelect.value !== "copy") {
            let words = countWords(writeArea.innerText);
            let wpm = Math.round(words / ((Date.now() - sessionStartTime) / 60000));
            let apm = Math.round(keyPressCount / ((Date.now() - sessionStartTime) / 60000));
            let errorCount = 0;
            let sessionDuration = Math.floor((Date.now() - sessionStartTime) / 1000);
            let sessionScore = calculateSessionScore(words, errorCount, wpm, sessionDuration);
            userStats.wissenspunkte += Math.round(sessionScore / 10);
            updateXPAndLevelDisplay();
            saveSessionToLeaderboard();
            updateLeaderboard();
            updateProfileUI();
            showSessionResults(words, wpm, apm, errorCount, sessionScore);
          }
          endSession();
        }
      }, 1000);
    }
    
    function resetSession() {
      clearInterval(timerInterval);
      clearTimeout(idleTimeout);
      sessionActive = false;
      remainingTime = parseInt(timeSelect.value) * 60;
      writeArea.innerText = currentLanguage === 'de' ? "Dr√ºcke Enter, um das Spiel zu starten" : "Press Enter to start the game";
      waitingForStart = true;
      updateTimerDisplay();
      updateWordCount();
      writeArea.classList.remove("warning");
      keyPressCount = 0;
      boss = null;
      bossDefeated = false;
      document.getElementById("bossContainer").style.display = "none";
      hotStreakIndicator.style.display = "none";
      copyTargetElem.style.display = "none";
      document.getElementById("checkBtn").style.display = "none";
      document.getElementById("copyScoreDisplay").style.display = "none";
      endSessionPopup.style.display = "none";
      
      if (modeSelect.value === "copy") {
        initCopyMode();
      }
    }
    
    function endSession() {
      clearInterval(timerInterval);
      clearTimeout(idleTimeout);
      sessionActive = false;
      
      if (modeSelect.value !== "copy") {
        // Ergebnis-Popup wird in showSessionResults() angezeigt
      } else {
        let message = currentLanguage === 'de' ? "Deine Copy Challenge Punkte: " + copyScore : "Your Copy Challenge score: " + copyScore;
        endSessionPopup.innerHTML = `<h2>${currentLanguage === 'de' ? "Session beendet!" : "Session Ended!"}</h2>
                                     <p>${message}</p>
                                     <button onclick="closeResultsPopup()">${currentLanguage === 'de' ? "Schlie√üen" : "Close"}</button>`;
        endSessionPopup.style.display = "block";
      }
      
      const currentWords = countWords(writeArea.innerText);
      for (let threshold in sessionAchievements) {
        if (currentWords >= threshold && !sessionAchievements[threshold].achieved) {
          sessionAchievements[threshold].achieved = true;
          const achieveElem = document.getElementById("achieve" + threshold);
          if (achieveElem) { achieveElem.textContent = "Erreicht"; }
        }
      }
      const sessionDuration = Math.floor((Date.now() - sessionStartTime) / 1000);
      const xpEarned = currentWords + Math.floor(sessionDuration / 10);
      userStats.xp += xpEarned;
      userStats.totalWords += currentWords;
      if (sessionDuration > userStats.longestSession) { userStats.longestSession = sessionDuration; }
      checkLevelUp();
      saveSessionToLeaderboard();
      updateLeaderboard();
      copyTargetElem.style.display = "none";
      document.getElementById("checkBtn").style.display = "none";
      document.getElementById("copyScoreDisplay").style.display = "none";
      updateProfileUI();
    }
    
    function initBoss() {
      boss = { name: "Wort Boss", maxHealth: 500, currentHealth: 500, targetWords: window.baseTarget * 1.5 };
      bossDefeated = false;
      document.getElementById("bossContainer").style.display = "block";
      document.getElementById("bossName").textContent = boss.name;
      updateBossUI();
    }
    
    function updateBossUI() {
      let healthPercent = (boss.currentHealth / boss.maxHealth) * 100;
      document.getElementById("bossHealth").style.width = healthPercent + "%";
    }
    
    function processNewTextForBossDamage() {
      let fullText = writeArea.innerText;
      let newText = fullText.substring(lastProcessedIndex);
      if (newText.trim().length === 0) return 0;
      let damage = 0;
      let sentenceRegex = /[^\.!\?]+[\.!\?]+/g;
      let sentences = newText.match(sentenceRegex);
      if (!sentences) { sentences = [newText]; }
      sentences.forEach(sentence => {
        let sentenceDamage = 0;
        let words = sentence.trim().split(/\s+/);
        words.forEach(word => {
          let cleanedWord = word.replace(/^[^A-Za-z√Ñ√ñ√ú√§√∂√º√ü'-]+|[^A-Za-z√Ñ√ñ√ú√§√∂√º√ü'-]+$/g, '');
          if (cleanedWord.length > 0) { sentenceDamage += cleanedWord.length; }
        });
        damage += sentenceDamage + Math.round(sentenceDamage * 0.2);
      });
      damage += checkHotStreakBonus();
      lastProcessedIndex = fullText.length;
      return damage;
    }
    
    function updateBossStatus() {
      let newDamage = processNewTextForBossDamage();
      if (newDamage > 0) { boss.currentHealth = Math.max(boss.currentHealth - newDamage, 0); }
      updateBossUI();
      if (boss.currentHealth <= 0 && !bossDefeated) { bossDefeated = true; winGame(); }
    }
    
    function winGame() {
      let bonusXP = 50;
      let bonusWissenspunkte = 50;
      showAchievement(currentLanguage === 'de' ? "Boss besiegt! Bonus XP und Wissenspunkte erhalten!" : "Boss defeated! Bonus XP and points awarded!");
      userStats.xp += bonusXP;
      userStats.wissenspunkte += bonusWissenspunkte;
      unlockReward("üèÜ Boss-Besieger Emoji");
      clearInterval(timerInterval);
      clearTimeout(idleTimeout);
      endSessionPopup.innerHTML = `<h2>${currentLanguage === 'de' ? "Gewonnen! Boss besiegt!" : "You Won! Boss Defeated!"}</h2>
                                   <p>${currentLanguage === 'de' ? "Bonus XP:" : "Bonus XP:"} ${bonusXP}</p>
                                   <p>${currentLanguage === 'de' ? "Bonus Wissenspunkte:" : "Bonus Points:"} ${bonusWissenspunkte}</p>
                                   <button onclick="closeResultsPopup()">${currentLanguage === 'de' ? "Schlie√üen" : "Close"}</button>`;
      endSessionPopup.style.display = "block";
      updateProfileUI();
    }
    
    function generateAchievements() {
      sessionAchievements = {};
      let threshold = 25;
      while (threshold <= window.baseTarget) {
        sessionAchievements[threshold] = { achieved: false, category: (threshold < 100 ? "Freewrite" : threshold < 200 ? "Copy" : "Allgemein") };
        threshold += 25;
      }
      updateAchievementsTable();
    }
    
    function updateAchievementsTable() {
      const tbody = document.getElementById("achievementBody");
      tbody.innerHTML = "";
      const tier = (difficultySelect.value === "easy") ? "Bronze" : (difficultySelect.value === "normal") ? "Silber" : "Gold";
      const timeMode = parseInt(timeSelect.value);
      const timeLabel = (timeMode === 1) ? "Minute" : "Minuten";
      for (let threshold in sessionAchievements) {
        const ach = sessionAchievements[threshold];
        const row = document.createElement("tr");
        row.setAttribute("data-category", ach.category);
        row.innerHTML = `<td>${timeMode} ${timeLabel}: ${tier} ${threshold}+ W√∂rter</td>
                         <td>Mindestens ${threshold} W√∂rter in ${timeMode} ${timeLabel}</td>
                         <td id="achieve${threshold}">${ach.achieved ? "Erreicht" : "Nicht erreicht"}</td>`;
        tbody.appendChild(row);
      }
    }
    
    writeArea.addEventListener("keydown", (e) => {
      if (!sessionActive && waitingForStart && e.key === "Enter") {
         e.preventDefault();
         waitingForStart = false;
         writeArea.innerText = "";
         startSession();
         return;
      }
      if (!sessionActive) return;
      if (modeSelect.value === "copy" && e.key === "Enter") {
         e.preventDefault();
         checkCopySentence();
         return;
      }
      resetIdleTimer();
      updateWordCount();
      keyPressCount++;
      const currentTime = Date.now();
      if (currentTime - lastKeyTime < hotStreakTimeThreshold) { hotStreakCounter++; }
      else { hotStreakCounter = 1; }
      lastKeyTime = currentTime;
      if (hotStreakCounter >= hotStreakRequired) { showHotStreakIndicator(); }
    });
    
    // Initiales Rendern
    renderShop();
    renderInventory();
    updateLeaderboard();
    updateProfileUI();

  </script>
</body>
</html>
