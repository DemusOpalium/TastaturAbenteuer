<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title data-translate="title">Schreibabenteuer DemusOpalium</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@700&family=Roboto:wght@400;700&family=Merriweather:wght@400;700&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
  <!-- Animate.css für Animationen -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
    /* Basis-Reset */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    /* Grundlayout und Themes */
    body {
      font-family: 'Roboto', sans-serif;
      transition: background 0.5s ease, color 0.5s ease;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    /* Vorhandene Themes */
    .theme-dark { background: linear-gradient(135deg, #2c3e50, #4ca1af); color: #f0f0f0; }
    .theme-light { background: #f7f7f7; color: #333; }
    .theme-vintage { background: #f4e8c1; color: #5a4b3b; }
    /* Neue Themes */
    .theme-neon { background: #0f0f0f; color: #39ff14; }
    .theme-pastel { background: #ffe6f0; color: #ff8fa3; }
    .theme-ocean { background: #1e3d59; color: #a2d5f2; }
    .theme-forest { background: #2d4739; color: #cdeac0; }
    .theme-sunset { background: #ff9a8d; color: #4b134f; }
    /* Rahmen für Buttons, Selects und Labels */
    .theme-dark button, .theme-dark select, .theme-dark label { border: 1px solid #444; }
    .theme-light button, .theme-light select, .theme-light label { border: 1px solid #ccc; }
    .theme-vintage button, .theme-vintage select, .theme-vintage label { border: 1px solid #a67c52; }
    .theme-neon button, .theme-neon select, .theme-neon label { border: 1px solid #39ff14; }
    .theme-pastel button, .theme-pastel select, .theme-pastel label { border: 1px solid #ff8fa3; }
    .theme-ocean button, .theme-ocean select, .theme-ocean label { border: 1px solid #a2d5f2; }
    .theme-forest button, .theme-forest select, .theme-forest label { border: 1px solid #cdeac0; }
    .theme-sunset button, .theme-sunset select, .theme-sunset label { border: 1px solid #4b134f; }
    /* Überschrift */
    .title {
      font-family: 'Lora', serif;
      font-size: 2.5em;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
      text-transform: uppercase;
    }
    /* Profilbereich */
    #profileContainer {
      width: 100%;
      max-width: 800px;
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    #profileImage {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #ccc;
      object-fit: cover;
      border: 2px solid #fff;
    }
    #profileDetails { flex: 1; color: inherit; }
    #profileDetails h3, #profileDetails p { margin: 3px 0; }
    /* Rang-Badge im Profilbereich */
    .rank-badge {
      background: gold;
      color: #000;
      padding: 3px 6px;
      border-radius: 4px;
      font-weight: bold;
      margin-left: 8px;
      font-size: 0.8em;
    }
    /* Shopbereich */
    #shopContainer {
      width: 100%;
      max-width: 800px;
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
    }
    #shopContainer h2 { margin-bottom: 10px; }
    #shopContainer button {
      margin: 5px;
      padding: 5px 10px;
      font-size: 0.9em;
      border-radius: 5px;
      background: rgba(255,255,255,0.2);
      color: inherit;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    #shopContainer button:hover { background: rgba(255,255,255,0.4); }
    /* Refresh-Buttons im Shop */
    #shopContainer .refresh-btn {
      margin-top: 10px;
      background: #0077cc;
      color: #fff;
      border: none;
    }
    #shopContainer .refresh-btn:hover { background: #005fa3; }
    /* Inventarbereich */
    #inventoryContainer {
      width: 100%;
      max-width: 800px;
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    #inventoryContainer h2 { text-align: center; margin-bottom: 10px; }
    #inventoryContainer div { margin-bottom: 10px; }
    #inventoryContainer img { margin: 5px; border: 2px solid #fff; border-radius: 4px; cursor: pointer; }
    /* Info Button & Modal */
    #infoBtn {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      padding: 10px;
      font-size: 1.5em;
      cursor: pointer;
      transition: background 0.3s ease;
      z-index: 100;
    }
    #infoBtn:hover { background: rgba(255,255,255,0.4); }
    .modal {
      display: none;
      position: fixed;
      z-index: 200;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #fff;
      color: #333;
      padding: 20px;
      border-radius: 8px;
      max-width: 600px;
      width: 90%;
      text-align: left;
      font-family: 'Roboto', sans-serif;
    }
    .close-btn {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close-btn:hover { color: #000; }
    /* Dropdowns & Buttons */
    .design-controls, .extra-controls {
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .design-controls select, .extra-controls select, .extra-controls button {
      padding: 10px;
      font-size: 1em;
      border-radius: 5px;
      background: rgba(255,255,255,0.2);
      color: inherit;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .design-controls select:hover, .extra-controls select:hover, .extra-controls button:hover {
      background: rgba(255,255,255,0.4);
    }
    /* Statusleiste */
    .status-bar {
      margin-bottom: 15px;
      font-size: 1.1em;
      background: rgba(0,0,0,0.3);
      padding: 10px 15px;
      border-radius: 5px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    .status-item { min-width: 100px; text-align: center; }
    #copyScoreDisplay { display: none; }
    /* Schreibbereich */
    #writeArea {
      width: 100%;
      max-width: 800px;
      height: 300px;
      background: rgba(255,255,255,0.1);
      color: inherit;
      padding: 15px;
      border: 2px solid;
      border-radius: 8px;
      outline: none;
      overflow-y: auto;
      font-size: 1.1em;
      line-height: 1.5em;
      transition: background 0.3s ease;
    }
    .theme-dark #writeArea { border-color: #444; }
    .theme-light #writeArea { border-color: #ccc; }
    .theme-vintage #writeArea { border-color: #a67c52; }
    .theme-neon #writeArea { border-color: #39ff14; }
    .theme-pastel #writeArea { border-color: #ff8fa3; }
    .theme-ocean #writeArea { border-color: #a2d5f2; }
    .theme-forest #writeArea { border-color: #cdeac0; }
    .theme-sunset #writeArea { border-color: #4b134f; }
    #writeArea.warning { background: rgba(200,50,50,0.5); animation: shake 0.5s infinite alternate; }
    @keyframes shake { from { transform: translateX(0); } to { transform: translateX(3px); } }
    /* Copy Challenge */
    #copyTarget {
      display: none;
      border: 2px solid #000;
      background: #fff;
      color: #000;
      padding: 10px;
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 10px;
      border-radius: 5px;
    }
    #targetSentence { font-weight: bold; }
    /* Steuerungselemente */
    .controls {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .controls label, .controls select, .controls button {
      padding: 10px 15px;
      font-size: 1em;
      border-radius: 5px;
      background: rgba(255,255,255,0.2);
      color: inherit;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .controls button:hover, .controls select:hover, .controls label:hover {
      background: rgba(255,255,255,0.4);
    }
    /* Boss-Anzeige */
    #bossContainer { display: none; margin-top: 10px; text-align: center; }
    #bossName { font-size: 1.2em; font-weight: bold; margin-bottom: 5px; }
    #bossHealthBar {
      background: red;
      width: 300px;
      height: 20px;
      border-radius: 10px;
      overflow: hidden;
      margin: 0 auto;
    }
    #bossHealth {
      background: green;
      width: 100%;
      height: 100%;
      transition: width 0.5s ease;
    }
    /* Achievement-Popup */
    .achievement {
      margin-top: 20px;
      padding: 15px;
      background: rgba(255,215,0,0.8);
      border-radius: 8px;
      font-size: 1.2em;
      font-weight: bold;
      color: #333;
      display: none;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    /* Erfolge & Belohnungen */
    .achievements-rewards-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      max-width: 800px;
      width: 100%;
      margin-top: 20px;
    }
    .achievements-section, .rewards-section {
      flex: 1 1 380px;
      background: rgba(0,0,0,0.3);
      padding: 15px;
      border-radius: 8px;
    }
    .achievements-section h2, .rewards-section h2 { text-align: center; margin-bottom: 10px; }
    .achievement-filters {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .achievement-filters label { font-size: 0.9em; }
    .achievement-filters select { padding: 5px; font-size: 0.9em; }
    #achievementTable {
      width: 100%;
      border-collapse: collapse;
    }
    #achievementTable th, #achievementTable td {
      padding: 8px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    #achievementTable th { background: rgba(255,255,255,0.2); }
    /* Leaderboard */
    .leaderboard {
      margin-top: 20px;
      max-width: 800px;
      width: 100%;
      background: rgba(0,0,0,0.3);
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
    }
    .leaderboard table {
      width: 100%;
      border-collapse: collapse;
    }
    .leaderboard th, .leaderboard td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .leaderboard th { background: rgba(255,255,255,0.2); }
    /* End Session Popup */
    #endSessionPopup {
      display: none;
      position: fixed;
      z-index: 300;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      color: #333;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      text-align: center;
      max-width: 90%;
    }
    #endSessionPopup button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      border-radius: 5px;
      border: none;
      background: #0077cc;
      color: #fff;
      transition: background 0.3s ease;
    }
    #endSessionPopup button:hover { background: #005fa3; }
    /* CSS Animation für Würfel-Popup */
    .dice-animation {
      animation: rollDice 0.5s ease-in-out;
    }
    @keyframes rollDice {
      0% { transform: rotate(0deg); }
      50% { transform: rotate(180deg); }
      100% { transform: rotate(360deg); }
    }
    .fade-out {
      animation: fadeOut 1s forwards;
    }
    @keyframes fadeOut {
      to { opacity: 0; }
    }
    /* Responsive Layout */
    @media (max-width: 600px) {
      #writeArea { height: 250px; }
      .status-bar, .controls, .design-controls, .extra-controls, .achievements-rewards-container {
        flex-direction: column;
      }
      #profileContainer { flex-direction: column; align-items: center; }
    }
    /* Button für Sprachumschaltung */
    #langBtn {
      position: fixed;
      top: 10px;
      left: 10px;
      padding: 5px 10px;
      font-size: 1em;
      cursor: pointer;
      z-index: 300;
    }
  </style>
</head>
<body class="theme-dark">
  <!-- Sprachumschalt-Button -->
  <button id="langBtn" onclick="toggleLanguage()">EN</button>

  <!-- Profilbereich -->
  <div id="profileContainer">
    <img id="profileImage" src="https://via.placeholder.com/80" alt="Profilbild">
    <div id="profileDetails">
      <h3 id="playerName" data-translate="playerName">Spielername</h3>
      <p id="playerRank" data-translate="playerRank">Rang: <span class="rank-badge">Bronze</span></p>
      <p id="playerWissenspunkte" data-translate="playerPoints">Wissenspunkte: 0</p>
    </div>
  </div>

  <!-- Namensänderung -->
  <div id="nameChangeContainer">
    <input type="text" id="playerNameInput" data-translate-placeholder="newNamePlaceholder" placeholder="Neuen Namen eingeben">
    <button id="changeNameBtn" data-translate="changeNameBtn">Namen ändern</button>
  </div>
  
  <!-- Shopbereich -->
  <div id="shopContainer">
    <h2 data-translate="shopTitle">Shop</h2>
    <div id="shopProfileSection"></div>
    <div id="shopGluecksbringerSection"></div>
    <button class="refresh-btn" onclick="refreshProfile()" data-translate="profileRefresh">Profil Refresh</button>
    <button class="refresh-btn" onclick="refreshGluecksbringer()" data-translate="gluecksbringerRefresh">Glücksbringer Refresh</button>
  </div>
  
  <!-- Inventarbereich -->
  <div id="inventoryContainer">
    <h2 data-translate="inventoryTitle">Inventar</h2>
    <!-- Inventar wird dynamisch gerendert -->
  </div>
  
  <!-- Info Button & Modal -->
  <button id="infoBtn">ℹ️</button>
  <div id="infoModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="closeInfo">&times;</span>
      <h2 style="color: #0077cc;" data-translate="infoTitle">Willkommen bei Schreibabenteuer DemusOpalium! ✨</h2>
      <p>
        <strong data-translate="infoOverviewTitle">📜 Überblick:</strong><br>
        <span data-translate="infoOverview">
          Schreibe in variablen Zeitmodi (1–5 Minuten) spannende Challenges – egal ob Freewrite, Adventure, Copy Challenge oder Hardcore. Nur Tippen, kein Kopieren!
        </span>
      </p>
      <p>
        <strong data-translate="infoModesTitle">🚀 Modi:</strong><br>
        <span data-translate="infoModes">
          Freewrite, Adventure (gegen den Wort-Boss), Copy Challenge und Hardcore.
        </span>
      </p>
      <p>
        <strong data-translate="infoNoticeTitle">⚠️ Hinweis:</strong><br>
        <span data-translate="infoNotice">
          Copy-Paste ist verboten! Schummeln gibt‘s nicht!
        </span>
      </p>
      <p>
        <strong data-translate="infoRewardsTitle">🎉 Belohnungen & Erfolge:</strong><br>
        <span data-translate="infoRewards">
          Schalte Erfolge frei und erhalte coole Rewards – dein Fortschritt wird gespeichert!
        </span>
      </p>
    </div>
  </div>
  
  <!-- Überschrift -->
  <div class="title" data-translate="title">Schreibabenteuer DemusOpalium</div>
  
  <!-- Design & Extra Controls -->
  <div class="design-controls">
    <label for="themeSelect" data-translate="chooseTheme">Theme wählen:</label>
    <select id="themeSelect">
      <option value="theme-dark" selected>Dark</option>
      <option value="theme-light">Light</option>
      <option value="theme-vintage">Vintage</option>
      <option value="theme-neon">Neon</option>
      <option value="theme-pastel">Pastel</option>
      <option value="theme-ocean">Ocean</option>
      <option value="theme-forest">Forest</option>
      <option value="theme-sunset">Sunset</option>
    </select>
    <label for="fontSelect" data-translate="chooseFont">Schriftart wählen:</label>
    <select id="fontSelect">
      <option value="'Roboto', sans-serif" selected>Roboto</option>
      <option value="'Lora', serif">Lora</option>
      <option value="'Merriweather', serif">Merriweather</option>
      <option value="'Open Sans', sans-serif">Open Sans</option>
      <option value="'Courier New', monospace">Courier New</option>
    </select>
  </div>
  <div class="extra-controls">
    <label for="difficultySelect" data-translate="difficulty">Schwierigkeitsgrad:</label>
    <select id="difficultySelect">
      <option value="easy" selected>Einfach</option>
      <option value="normal">Normal</option>
      <option value="hard">Schwer</option>
    </select>
    <label for="librarySelect" data-translate="category">Kategorie:</label>
    <select id="librarySelect">
      <option value="standard" selected>Standard</option>
      <option value="realschule">Realschule</option>
      <option value="gymnasium">Gymnasium</option>
      <option value="medizin">Medizin</option>
      <option value="bank">Bank</option>
      <option value="tierwelt">Tierwelt</option>
      <option value="code_python">Code/Python</option>
    </select>
    <button id="shareBtn" data-translate="shareResults">Ergebnisse Teilen</button>
    <button id="saveProfileBtn" data-translate="saveProfile">Profil Speichern</button>
    <button id="loadProfileBtn" data-translate="loadProfile">Profil Laden</button>
    <input type="file" id="loadProfileInput" style="display:none;" accept=".txt, .json">
  </div>
  
  <!-- Statusleiste -->
  <div class="status-bar">
    <div class="status-item" id="timer" data-translate="time">Time: 01:00</div>
    <div class="status-item" id="wordCount" data-translate="words">Words: 0</div>
    <div class="status-item" id="goalProgress" data-translate="goal">Goal: 0/100</div>
    <div class="status-item" id="xpDisplay" data-translate="xp">XP: 0</div>
    <div class="status-item" id="levelDisplay" data-translate="level">Level: 1</div>
    <div class="status-item" id="wpmDisplay" data-translate="wpm">WPM: 0</div>
    <div class="status-item" id="apmDisplay" data-translate="apm">APM: 0</div>
    <div class="status-item" id="hotStreakIndicator" data-translate="hotStreak">HOT STREAK!</div>
    <div class="status-item" id="copyScoreDisplay" style="display:none;" data-translate="copyScore">Copy Score: 0</div>
  </div>
  
  <!-- Steuerungselemente -->
  <div class="controls">
    <label for="modeSelect" data-translate="mode">Modus:</label>
    <select id="modeSelect">
      <option value="free" data-translate="freeMode">Freewrite (keine Strafe)</option>
      <option value="hardcore" data-translate="hardcoreMode">Hardcore (Text löschen)</option>
      <option value="creative" data-translate="creativeMode">Kreativ (mit Schreibimpuls)</option>
      <option value="adventure" data-translate="adventureMode">Adventure (Boss &amp; EPIC)</option>
      <option value="copy" data-translate="copyMode">Copy Challenge</option>
    </select>
    <label for="timeSelect" data-translate="timeMode">Zeitmodus:</label>
    <select id="timeSelect">
      <option value="1">1 Minute</option>
      <option value="2">2 Minuten</option>
      <option value="3">3 Minuten</option>
      <option value="4">4 Minuten</option>
      <option value="5" selected>5 Minuten</option>
    </select>
    <button id="startBtn" data-translate="prepareGame">Spiel vorbereiten</button>
    <button id="resetBtn" data-translate="reset">Reset</button>
    <button id="promptBtn" style="display:none;" data-translate="showPrompt">Schreibimpuls anzeigen</button>
  </div>
  
  <!-- Copy Challenge -->
  <div id="copyTarget" style="display:none;">&gt; <span id="targetSentence"></span></div>
  <button id="checkBtn" style="display:none;" data-translate="checkSentence">Satz prüfen</button>
  
  <!-- Boss-Anzeige -->
  <div id="bossContainer" style="display:none;">
    <div id="bossName"></div>
    <div id="bossHealthBar"><div id="bossHealth"></div></div>
  </div>
  
  <!-- Schreibbereich -->
  <div id="writeArea" contenteditable="true" data-translate-placeholder="writePlaceholder" placeholder="Hier beginnen zu schreiben..."></div>
  
  <!-- Achievement-Popup -->
  <div class="achievement animate__animated" id="achievementPopup">Achievement unlocked! 🎉</div>
  
  <!-- Erfolge & Belohnungen -->
  <div class="achievements-rewards-container">
    <div class="achievements-section">
      <h2 data-translate="achievementsTitle">Erfolge</h2>
      <div class="achievement-filters">
        <label for="achievementCategoryFilter" data-translate="achievementCategory">Kategorie:</label>
        <select id="achievementCategoryFilter">
          <option value="all" data-translate="all">Alle</option>
          <option value="Freewrite">Freewrite</option>
          <option value="Adventure">Adventure</option>
          <option value="Copy">Copy Challenge</option>
          <option value="Hardcore">Hardcore</option>
          <option value="Allgemein">Allgemeine &amp; Langzeit</option>
          <option value="Kreativ">Kreativ</option>
        </select>
        <label for="achievementDifficultyFilter" data-translate="achievementDifficulty">Schwierigkeitsgrad:</label>
        <select id="achievementDifficultyFilter">
          <option value="all" data-translate="all">Alle</option>
          <option value="easy" data-translate="easy">Leicht</option>
          <option value="normal" data-translate="normal">Normal</option>
          <option value="hard" data-translate="hard">Schwer/Episch</option>
        </select>
      </div>
      <table id="achievementTable">
        <thead>
          <tr>
            <th data-translate="icon">Icon</th>
            <th data-translate="achievement">Erfolg</th>
            <th data-translate="condition">Bedingung</th>
            <th data-translate="status">Status</th>
          </tr>
        </thead>
        <tbody id="achievementBody">
          <!-- Dynamisch generierte Erfolge -->
        </tbody>
      </table>
    </div>
    <div class="rewards-section">
      <h2 data-translate="rewardsTitle">Belohnungen</h2>
      <ul id="rewardList"></ul>
    </div>
  </div>
  
  <!-- Leaderboard -->
  <div class="leaderboard">
    <h2 data-translate="leaderboardTitle">Highscore-Liste ⭐</h2>
    <table id="leaderboardTable">
      <thead>
        <tr>
          <th data-translate="rank">Platz</th>
          <th data-translate="words">Wörter</th>
          <th data-translate="xp">XP</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody">
        <!-- Dynamisch befüllte Zeilen -->
      </tbody>
    </table>
  </div>
  
  <!-- End Session Popup -->
  <div id="endSessionPopup" style="display:none;">
    <!-- Der Popup-Inhalt wird dynamisch befüllt -->
  </div>
  
  <script>
    /* --- Übersetzungs-Objekt mit 3 Sprachen --- */
    const translations = {
      "de": {
        "title": "Schreibabenteuer DemusOpalium",
        "playerName": "Spielername",
        "playerRank": "Rang:",
        "playerPoints": "Wissenspunkte:",
        "newNamePlaceholder": "Neuen Namen eingeben",
        "changeNameBtn": "Namen ändern",
        "shopTitle": "Shop",
        "profileRefresh": "Profil Refresh",
        "gluecksbringerRefresh": "Glücksbringer Refresh",
        "inventoryTitle": "Inventar",
        "infoTitle": "Willkommen bei Schreibabenteuer DemusOpalium! ✨",
        "infoOverviewTitle": "📜 Überblick:",
        "infoOverview": "Schreibe in variablen Zeitmodi (1–5 Minuten) spannende Challenges – egal ob Freewrite, Adventure, Copy Challenge oder Hardcore. Nur Tippen, kein Kopieren!",
        "infoModesTitle": "🚀 Modi:",
        "infoModes": "Freewrite, Adventure (gegen den Wort-Boss), Copy Challenge und Hardcore.",
        "infoNoticeTitle": "⚠️ Hinweis:",
        "infoNotice": "Copy-Paste ist verboten! Schummeln gibt‘s nicht!",
        "infoRewardsTitle": "🎉 Belohnungen & Erfolge:",
        "infoRewards": "Schalte Erfolge frei und erhalte coole Rewards – dein Fortschritt wird gespeichert!",
        "chooseTheme": "Theme wählen:",
        "chooseFont": "Schriftart wählen:",
        "difficulty": "Schwierigkeitsgrad:",
        "category": "Kategorie:",
        "shareResults": "Ergebnisse Teilen",
        "saveProfile": "Profil Speichern",
        "loadProfile": "Profil Laden",
        "time": "Time: 01:00",
        "words": "Words: 0",
        "goal": "Goal: 0/100",
        "xp": "XP: 0",
        "level": "Level: 1",
        "wpm": "WPM: 0",
        "apm": "APM: 0",
        "hotStreak": "HOT STREAK!",
        "copyScore": "Copy Score: 0",
        "mode": "Modus:",
        "freeMode": "Freewrite (keine Strafe)",
        "hardcoreMode": "Hardcore (Text löschen)",
        "creativeMode": "Kreativ (mit Schreibimpuls)",
        "adventureMode": "Adventure (Boss & EPIC)",
        "copyMode": "Copy Challenge",
        "timeMode": "Zeitmodus:",
        "prepareGame": "Spiel vorbereiten",
        "reset": "Reset",
        "showPrompt": "Schreibimpuls anzeigen",
        "checkSentence": "Satz prüfen",
        "achievementsTitle": "Erfolge",
        "achievementCategory": "Kategorie:",
        "achievementDifficulty": "Schwierigkeitsgrad:",
        "all": "Alle",
        "easy": "Leicht",
        "normal": "Normal",
        "hard": "Schwer/Episch",
        "icon": "Icon",
        "achievement": "Erfolg",
        "condition": "Bedingung",
        "status": "Status",
        "rewardsTitle": "Belohnungen",
        "leaderboardTitle": "Highscore-Liste ⭐",
        "rank": "Platz",
        "writePlaceholder": "Hier beginnen zu schreiben..."
      },
      "en": {
        "title": "Writing Adventure DemusOpalium",
        "playerName": "Player Name",
        "playerRank": "Rank:",
        "playerPoints": "Knowledge Points:",
        "newNamePlaceholder": "Enter new name",
        "changeNameBtn": "Change Name",
        "shopTitle": "Shop",
        "profileRefresh": "Refresh Profile",
        "gluecksbringerRefresh": "Refresh Charm",
        "inventoryTitle": "Inventory",
        "infoTitle": "Welcome to Writing Adventure DemusOpalium! ✨",
        "infoOverviewTitle": "📜 Overview:",
        "infoOverview": "Write exciting challenges in variable time modes (1–5 minutes) – whether it's Freewrite, Adventure, Copy Challenge or Hardcore. Just type, no copying!",
        "infoModesTitle": "🚀 Modes:",
        "infoModes": "Freewrite, Adventure (against the Word Boss), Copy Challenge and Hardcore.",
        "infoNoticeTitle": "⚠️ Notice:",
        "infoNotice": "Copy-paste is prohibited! No cheating allowed!",
        "infoRewardsTitle": "🎉 Rewards & Achievements:",
        "infoRewards": "Unlock achievements and receive cool rewards – your progress will be saved!",
        "chooseTheme": "Choose Theme:",
        "chooseFont": "Choose Font:",
        "difficulty": "Difficulty:",
        "category": "Category:",
        "shareResults": "Share Results",
        "saveProfile": "Save Profile",
        "loadProfile": "Load Profile",
        "time": "Time: 01:00",
        "words": "Words: 0",
        "goal": "Goal: 0/100",
        "xp": "XP: 0",
        "level": "Level: 1",
        "wpm": "WPM: 0",
        "apm": "APM: 0",
        "hotStreak": "HOT STREAK!",
        "copyScore": "Copy Score: 0",
        "mode": "Mode:",
        "freeMode": "Freewrite (no penalty)",
        "hardcoreMode": "Hardcore (text deletion)",
        "creativeMode": "Creative (with writing prompt)",
        "adventureMode": "Adventure (Boss & EPIC)",
        "copyMode": "Copy Challenge",
        "timeMode": "Time Mode:",
        "prepareGame": "Prepare Game",
        "reset": "Reset",
        "showPrompt": "Show Writing Prompt",
        "checkSentence": "Check Sentence",
        "achievementsTitle": "Achievements",
        "achievementCategory": "Category:",
        "achievementDifficulty": "Difficulty:",
        "all": "All",
        "easy": "Easy",
        "normal": "Normal",
        "hard": "Hard/Epic",
        "icon": "Icon",
        "achievement": "Achievement",
        "condition": "Condition",
        "status": "Status",
        "rewardsTitle": "Rewards",
        "leaderboardTitle": "Highscore List ⭐",
        "rank": "Rank",
        "writePlaceholder": "Start writing here..."
      },
      "sw": {
        "title": "Mchezo wa Kuandika DemusOpalium",
        "playerName": "Jina la Mchezaji",
        "playerRank": "Cheo:",
        "playerPoints": "Alama za Maarifa:",
        "newNamePlaceholder": "Weka jina jipya",
        "changeNameBtn": "Badilisha Jina",
        "shopTitle": "Duka",
        "profileRefresh": "Sasisha Wasifu",
        "gluecksbringerRefresh": "Sasisha Vibonzo",
        "inventoryTitle": "Hazina",
        "infoTitle": "Karibu katika Mchezo wa Kuandika DemusOpalium! ✨",
        "infoOverviewTitle": "📜 Muhtasari:",
        "infoOverview": "Andika changamoto za kusisimua kwa dakika 1–5 – iwe ni ya ubunifu, ya shindani au ya ukali. Andika tu, usikite nakili!",
        "infoModesTitle": "🚀 Mipangilio:",
        "infoModes": "Freewrite, Adventure (kupambana na Bosi wa Maneno), Copy Challenge na Hardcore.",
        "infoNoticeTitle": "⚠️ Onyo:",
        "infoNotice": "Nakili-paste ni marufuku! Usishindwe!",
        "infoRewardsTitle": "🎉 Tuzo na Mafanikio:",
        "infoRewards": "Fungua mafanikio na pokea tuzo nzuri – maendeleo yako yatahifadhiwa!",
        "chooseTheme": "Chagua Mandhari:",
        "chooseFont": "Chagua Aina ya Herufi:",
        "difficulty": "Ugonjwa:",
        "category": "Jamii:",
        "shareResults": "Shiriki Matokeo",
        "saveProfile": "Hifadhi Wasifu",
        "loadProfile": "Pakia Wasifu",
        "time": "Wakati: 01:00",
        "words": "Maneno: 0",
        "goal": "Lengo: 0/100",
        "xp": "XP: 0",
        "level": "Kiwango: 1",
        "wpm": "Maneno kwa Dakika: 0",
        "apm": "Mabofya kwa Dakika: 0",
        "hotStreak": "MFAKA ZA MOJA!",
        "copyScore": "Alama za Nakili: 0",
        "mode": "Mpangilio:",
        "freeMode": "Freewrite (hakuna adhabu)",
        "hardcoreMode": "Hardcore (maandishi yatafutwa)",
        "creativeMode": "Ubunifu (na dalili ya kuandika)",
        "adventureMode": "Adventure (Bosi & EPIC)",
        "copyMode": "Copy Challenge",
        "timeMode": "Muda:",
        "prepareGame": "Andaa Mchezo",
        "reset": "Washa upya",
        "showPrompt": "Onyesha Dalili ya Kuandika",
        "checkSentence": "Angalia Sentensi",
        "achievementsTitle": "Mafanikio",
        "achievementCategory": "Jamii:",
        "achievementDifficulty": "Ugonjwa:",
        "all": "Zote",
        "easy": "Rahisi",
        "normal": "Kawaida",
        "hard": "Gumu/Epiki",
        "icon": "Picha",
        "achievement": "Mafanikio",
        "condition": "Hali",
        "status": "Hali",
        "rewardsTitle": "Tuzo",
        "leaderboardTitle": "Orodha ya Nafasi ⭐",
        "rank": "Cheo",
        "writePlaceholder": "Anza kuandika hapa..."
      }
    };

    // Aktuelle Sprache (Standard: Deutsch)
    let currentLanguage = 'de';

    // Sprachumschaltung zyklisch: de -> en -> sw -> de ...
    function toggleLanguage() {
      if (currentLanguage === 'de') {
        currentLanguage = 'en';
      } else if (currentLanguage === 'en') {
        currentLanguage = 'sw';
      } else {
        currentLanguage = 'de';
      }
      updateLanguage();
    }

    // Aktualisiert alle Elemente mit Übersetzungsschlüsseln
    function updateLanguage() {
      document.documentElement.lang = currentLanguage;
      document.title = translations[currentLanguage].title;
      document.querySelectorAll('[data-translate]').forEach(elem => {
        let key = elem.getAttribute('data-translate');
        if (translations[currentLanguage][key]) {
          elem.textContent = translations[currentLanguage][key];
        }
      });
      document.querySelectorAll('[data-translate-placeholder]').forEach(elem => {
        let key = elem.getAttribute('data-translate-placeholder');
        if (translations[currentLanguage][key]) {
          elem.placeholder = translations[currentLanguage][key];
        }
      });
      // Button-Text für Sprachumschaltung: de->EN, en->SW, sw->DE
      document.getElementById('langBtn').textContent = (currentLanguage === 'de') ? 'EN' : (currentLanguage === 'en' ? 'SW' : 'DE');
    }
    updateLanguage();

    /* --- Restlicher JavaScript-Code --- */
    let timerInterval = null, idleTimeout = null;
    let sessionActive = false;
    let sessionStartTime = null;
    let remainingTime = 60;
    let keyPressCount = 0;
    let hotStreakCounter = 0;
    let lastKeyTime = 0;
    let hotStreakRequired = 20;
    let hotStreakTimeThreshold = 250;
    let waitingForStart = false;
    let copyScore = 0;
    let currentTargetSentence = "";

    let userStats = { 
      xp: 0,
      totalWords: 0,
      longestSession: 0,
      level: 1,
      playerName: "Spielername",
      wissenspunkte: 500,
      profileImage: "",
      inventory: {
        profileImages: [],
        gluecksbringer: []
      }
    };

    const availableProfileImages = [
      "https://i.imgur.com/2cqISZ8.png",
      "https://i.imgur.com/WCghhSg.png",
      "https://i.imgur.com/AG8MXbR.png",
      "https://i.imgur.com/67lln3j.png",
      "https://i.imgur.com/NUfCLza.png",
      "https://i.imgur.com/dyOkN0p.png",
      "https://i.imgur.com/At7GxhG.png"
    ];
    const availableGluecksbringer = [
      "https://i.imgur.com/Qg6no9G.png",
      "https://i.imgur.com/N74fFUp.png",
      "https://i.imgur.com/zrOdwI6.png",
      "https://i.imgur.com/3atajUk.png",
      "https://i.imgur.com/3PAQktM.png",
      "https://i.imgur.com/E3B6FT4.png",
      "https://i.imgur.com/PsEpoi4.png"
    ];
    const shopProfileItems = availableProfileImages.map((url, index) => {
      return { id: "Profilbild " + (index + 1), imgUrl: url, price: 150 + (index * 25) };
    });
    const shopGluecksbringerItems = availableGluecksbringer.map((url, index) => {
      return { id: "Glücksbringer " + (index + 1), imgUrl: url, price: 150 + (index * 25) };
    });
    const secretKey = "geheimerSchluessel123";
    function generateHash(input) {
      let hash = 0;
      for (let i = 0; i < input.length; i++) {
        const chr = input.charCodeAt(i);
        hash = ((hash << 5) - hash) + chr;
        hash |= 0;
      }
      return hash;
    }

    /* --- Copy-Sätze --- */
    // Deutsche Satzbibliothek (komplett mit zahlreichen Sätzen)
    const sentenceLibraries = {
      standard: {
        easy: [
          "Der Hund läuft schnell.",
          "Die Sonne scheint hell.",
          "Ich mag Eis.",
          "Der Vogel fliegt hoch.",
          "Der Baum steht im Garten.",
          "Die Katze schläft leise.",
          "Das Auto fährt langsam.",
          "Das Kind lacht fröhlich.",
          "Die Blume duftet angenehm.",
          "Der Regen fällt sanft.",
          "Die Wolken ziehen langsam.",
          "Der Wind weht mild.",
          "Das Wasser glitzert im Licht.",
          "Der Schnee bedeckt den Boden.",
          "Die Vögel zwitschern im Frühling.",
          "Der Mond leuchtet in der Nacht.",
          "Die Sterne funkeln am Himmel.",
          "Der Fisch schwimmt im Teich.",
          "Der Hund bellt laut.",
          "Das Haus steht am Wegesrand.",
          "Die Bienen summen im Garten.",
          "Die Kinder spielen im Park.",
          "Der Apfel ist reif.",
          "Das Brot ist frisch gebacken.",
          "Der Zug fährt pünktlich.",
          "Das Buch liegt auf dem Tisch.",
          "Die Uhr zeigt die richtige Zeit.",
          "Der Wind kühlt an heißen Tagen.",
          "Die Blumen blühen im Frühling.",
          "Der Morgen ist ruhig und friedlich.",
          "Der Hund bellt im Garten.",
          "Die Katze jagt die Maus.",
          "Der Vogel singt am Morgen.",
          "Das Kind malt ein Bild.",
          "Die Blume duftet süß.",
          "Der Regen tropft leise.",
          "Die Sonne wärmt den Tag.",
          "Der Wind weht sanft.",
          "Das Auto parkt am Haus.",
          "Die Vögel fliegen hoch.",
          "Der Baum spendet Schatten.",
          "Die Wolken ziehen am Himmel.",
          "Der Fluss fließt ruhig.",
          "Das Wasser glitzert im See.",
          "Die Sterne leuchten in der Nacht.",
          "Der Mond scheint hell.",
          "Das Brot riecht frisch.",
          "Die Kinder rennen im Park.",
          "Der Hund rennt im Feld.",
          "Die Blätter fallen leise.",
          "Der Fuchs schleicht durch den Wald.",
          "Die Bienen sammeln Nektar.",
          "Das Pferd galoppiert schnell.",
          "Die Kuh grast auf der Wiese.",
          "Der Vogel baut ein Nest.",
          "Die Blumen leuchten bunt.",
          "Das Licht strahlt durch das Fenster.",
          "Die Musik klingt harmonisch.",
          "Der Regenbogen zeigt sich am Himmel.",
          "Die Schneeflocken tanzen im Wind.",
          "Das Eis schmilzt in der Sonne.",
          "Der Frosch quakt im Teich.",
          "Die Ameisen laufen emsig.",
          "Das Haus ist bunt gestrichen.",
          "Die Gans schwimmt im Teich.",
          "Der Adler fliegt majestätisch.",
          "Die Eule ruft in der Nacht.",
          "Das Feuer brennt warm.",
          "Die Wolken bedecken den Himmel.",
          "Der Berg ragt in den Himmel.",
          "Die Blume wächst im Frühling.",
          "Der See ist still und klar.",
          "Die Bäume rauschen im Wind.",
          "Das Kind spielt fröhlich im Garten.",
          "Der Hund schläft friedlich im Körbchen.",
          "Die Katze schnurrt leise.",
          "Das Wasser sprudelt im Bach.",
          "Die Vögel zwitschern fröhlich.",
          "Der Wind bringt frische Luft.",
          "Die Sonne geht langsam unter."
        ],
        normal: [
          "Ein majestätischer Adler kreist hoch am azurblauen Himmel und inspiriert alle, die ihn beobachten.",
          "Der schimmernde Fluss schlängelt sich elegant durch die grüne Landschaft, während die Sonne funkelnde Reflexionen wirft.",
          "In einem belebten Markt flanieren Menschen, während exotische Düfte die Luft erfüllen.",
          "Die alten Gemäuer einer Burg erzählen Geschichten von Mut und Verrat in jeder Steinplatte.",
          "Ein schlauer Fuchs schleicht durch den nebelverhangenen Wald, immer auf der Suche nach seiner Beute.",
          "Die zarten Rosen im Garten verströmen einen betörenden Duft, der Erinnerungen an vergangene Zeiten weckt.",
          "Ein einsamer Wanderer erklimmt beharrlich den steilen Berg, getrieben von der Sehnsucht nach Freiheit.",
          "Die goldenen Felder im Sommer wiegen sanft im Wind, als ob sie ein geheimes Lied singen würden.",
          "Ein mystischer Nebel legt sich über das Tal und verwandelt die Landschaft in ein Märchenland.",
          "Die alten Eichen, Zeugen vieler Jahre, flüstern leise von vergangenen Abenteuern.",
          "Ein kleiner Bach murmelt fröhlich vor sich hin, während er durch üppiges Grün plätschert.",
          "Die sanfte Brise trägt den Geruch von frisch gemähtem Gras und blühenden Blumen heran.",
          "Ein eleganter Schwan gleitet majestätisch über den stillen See, als wäre er die Königin der Gewässer.",
          "Die tiefblauen Tiefen des Meeres verbergen Geheimnisse, die nur die Mutigsten zu lüften wagen.",
          "Ein geheimnisvoller Regenbogen spannt sich über den Horizont und verheißt magische Zeiten.",
          "Bunte Schmetterlinge tanzen fröhlich zwischen den duftenden Frühlingsblumen.",
          "Ein alter Seemann erzählt in verrauchten Tavernen Geschichten von fernen Ländern und verlorenen Schätzen.",
          "Die flackernden Lichter einer nächtlichen Stadt spiegeln sich in den ruhigen Wasserwegen wider.",
          "Ein junger Künstler malt mit leuchtenden Farben ein Bild, das die Seele berührt.",
          "Die kühle Nachtluft füllt sich mit dem sanften Klang einer einsamen Geige.",
          "Ein tapferer Ritter reitet durch den nebligen Morgen, bereit, für seine Ehre zu kämpfen.",
          "Die funkelnden Sterne am klaren Himmel erzählen von unendlichen Möglichkeiten und Träumen.",
          "Ein geheimnisvoller Wald, in dem jeder Schritt ein neues Abenteuer verspricht, zieht den Suchenden in seinen Bann.",
          "Die alten Straßen einer Stadt sind Zeugen vergangener Zeiten, in denen Legenden geboren wurden.",
          "Ein sanfter Regen hüllt die Welt in einen Schleier aus Frische und Neubeginn.",
          "Die zarten Klänge eines Klaviers verweben sich mit dem Rauschen der Bäume zu einer Natur-Symphonie.",
          "Ein fröhlicher Vogel singt ein Lied, das Hoffnung und Freude in jedes Herz trägt.",
          "Funkenartige Tautropfen auf den Blättern malen ein Bild der Reinheit in der Morgensonne.",
          "Ein alter Leuchtturm wacht still über die stürmische Küste und weist verlorenen Seefahrern den Weg.",
          "Die ersten Sonnenstrahlen brechen durch den Morgennebel und erwecken die Welt zu neuem Leben.",
          "Ein weiser alter Mann sitzt im Schatten eines Baumes und teilt seine Lebenserfahrungen mit den Jungen.",
          "Die majestätischen Berge erheben sich stolz gegen den klaren Himmel und erzählen Geschichten von unerschütterlicher Kraft.",
          "Ein sanfter Wind spielt mit den Blättern und trägt leise Melodien durch die Luft.",
          "Die glitzernde Oberfläche eines Sees spiegelt die unendliche Weite des Himmels wider.",
          "Ein eleganter Pfau präsentiert sein farbenfrohes Gefieder in einem Fest der Natur.",
          "Die glühende Abenddämmerung taucht die Welt in ein warmes, goldenes Licht.",
          "Ein neugieriger Fuchs erkundet die geheimen Pfade des Waldes mit unermüdlicher Neugier.",
          "Tautropfen auf einem Spinnennetz glänzen wie kleine Diamanten im Morgengrauen.",
          "Ein sanfter Bach windet sich durch ein Tal, als erzähle er die Geschichten der Erde.",
          "Die alten Ruinen einer Stadt flüstern von vergangenen Reichen und vergessenen Heldentaten.",
          "Ein leiser Windhauch trägt den Klang alter Legenden in die Herzen derer, die zuhören.",
          "Die sternenklare Nacht enthüllt das verborgene Glitzern der Milchstraße, das den Himmel verzaubert.",
          "Ein lebhafter Markt erfüllt die Straßen mit fröhlichen Stimmen und dem Duft von frisch gebackenem Brot.",
          "Die sanfte Wärme eines Sommers lässt die Zeit stillzustehen und erfüllt die Seele mit Glück.",
          "Ein tapferer Krieger steht am Rande eines gewaltigen Schlachtfelds und blickt entschlossen in die Zukunft.",
          "Die leuchtenden Farben eines Herbstwaldes malen ein Bild, das die Vergänglichkeit der Zeit feiert.",
          "Ein junger Dichter sitzt am Ufer eines Flusses und lässt sich von den sanften Wellen inspirieren.",
          "Die klare Luft eines Berggipfels erfüllt den Geist mit frischer Energie und unendlicher Weite.",
          "Ein geheimnisvoller Nebel senkt sich über die Felder und hüllt die Welt in einen Schleier des Unbekannten.",
          "Die ersten Frühlingsblumen brechen tapfer durch den Schnee und verkünden das Ende des Winters.",
          "Ein leuchtender Regenbogen spannt sich über den Himmel und verbindet die Erde mit dem Firmament.",
          "Die sanften Klänge einer Geige erklingen in einem alten Theater und erwecken Erinnerungen an vergangene Zeiten.",
          "Ein junger Abenteurer tritt mutig in die weite Welt hinaus, getrieben von der Sehnsucht nach Freiheit.",
          "Die goldene Stunde verzaubert die Landschaft mit warmen, sanften Tönen, die die Seele berühren.",
          "Ein mystischer Nebel umgibt die alten Wälder und lässt die Grenzen zwischen Realität und Traum verschwimmen.",
          "Die ruhige See reflektiert den klaren Himmel und schenkt jedem, der sie betrachtet, einen Moment der Stille.",
          "Ein funkelnder Wasserfall stürzt in einem verborgenen Tal herab und erzeugt ein Rauschen, das an Magie erinnert.",
          "Die sanfte Berührung eines kühlen Windes bringt den Duft des Frühlings direkt in dein Herz."
        ],
        hard: [
          "Inmitten eines tobenden Sturms bahnt sich ein einsamer Held seinen Weg durch die übersäteten Trümmer der verlassenen Stadt, während der Wind unerbittlich heult.",
          "Die unaufhörlichen Regentropfen verschmelzen mit den Tränen des Verzweifelten, der in den dunklen Gassen nach einem Funken Hoffnung sucht.",
          "Während die finsteren Wolken den Himmel verdunkeln, enthüllt ein mutiger Dichter in seinen Versen die tiefen Abgründe menschlicher Emotionen.",
          "In den verfallenen Ruinen einer alten Festung, wo einst heldenhafte Taten vollbracht wurden, erkundet ein entschlossener Abenteurer das Geheimnis der Vergangenheit.",
          "Obwohl die Zeit gnadenlos voranschreitet, bewahrt ein alter Gelehrter in seinen Schriften die unvergänglichen Wahrheiten vergangener Zeiten.",
          "Mit jeder Zeile, die er schreibt, enthüllt der Dichter eine verborgene Welt, in der die Grenzen zwischen Realität und Traum verschwimmen.",
          "Der kalte Hauch des Winters mischt sich mit dem warmen Glanz eines verblassenden Sonnenaufgangs, während ein Reisender in die endlosen Weiten der Ungewissheit zieht.",
          "In den Schatten einer längst vergessenen Zivilisation findet ein Archäologe Hinweise auf ein Mysterium, das das Schicksal ganzer Reiche beeinflussen könnte.",
          "Die düsteren Geheimnisse eines verlassenen Schlosses werden nach und nach von einem entschlossenen Detektiv enthüllt, der sich den Abgründen der menschlichen Seele stellt.",
          "Während die Sterne unermüdlich am nächtlichen Firmament leuchten, erzählt eine alte Legende von einem Helden, der einst das Unmögliche möglich machte.",
          "In einem Labyrinth aus Erinnerungen und vergessenen Träumen kämpft ein einsamer Geist darum, die verlorene Schönheit vergangener Zeiten wiederzufinden.",
          "Mit unerschütterlicher Entschlossenheit durchquert ein Wanderer das trostlose Ödland, dessen karge Schönheit von unerklärlichen Geheimnissen durchdrungen ist.",
          "Die leisen Melodien eines vergessenen Liedes hallen durch die verfallenen Gänge einer alten Bibliothek, in der das Wissen vergangener Generationen bewahrt wird.",
          "Tief in den dunklen Tiefen einer verlassenen Mine entdeckt ein mutiger Abenteurer funkelnde Edelsteine, die von uralten Geheimnissen zeugen.",
          "Obwohl der Himmel von dunklen Wolken verhüllt ist, kämpft ein tapferer Krieger mit unbeirrbarem Mut gegen die Schatten seiner eigenen Vergangenheit.",
          "Während der Wind durch die verwitterten Bäume rauscht, offenbart sich ein verborgener Pfad, der zu einer Welt führt, die in Vergessenheit geraten ist.",
          "Inmitten eines tosenden Sturms steht ein alter Leuchtturm als stiller Wächter, der den Schiffen den Weg durch die tückischen Gewässer weist.",
          "Die melancholischen Klänge eines einsamen Klaviers erfüllen einen verlassenen Ballsaal und lassen die Geister vergangener Feste wieder lebendig werden.",
          "Mit jeder verstreichenden Sekunde enthüllt sich ein neues Kapitel des Lebens, während ein alter Chronist die unvergänglichen Geschichten der Menschheit niederschreibt.",
          "Obwohl der kalte Nebel die Landschaft umhüllt, durchdringt ein strahlender Lichtstrahl die Dunkelheit und schenkt dem Verlorenen einen Hauch von Hoffnung.",
          "In den bröckelnden Mauern einer uralten Kathedrale finden sich verborgene Inschriften, die von einem göttlichen Mysterium berichten.",
          "Die unendlichen Weiten einer stillen Wüste werden von den Spuren eines reisenden Nomaden durchzogen, der in den Sanden nach dem Sinn des Lebens sucht.",
          "Mit jedem Schritt, den der müde Wanderer setzt, hallt das Echo vergangener Zeiten wider und erinnert an verlorene Träume.",
          "Während der Regen unablässig auf die staubigen Straßen prasselt, enthüllt ein alter Geschichtenerzähler die Legenden einer längst vergangenen Epoche.",
          "Die funkelnden Lichter einer Metropole spiegeln sich in den nassen Pflastersteinen, während ein einsamer Beobachter den Puls der Stadt spürt.",
          "In den verworrenen Gassen einer alten Stadt, in der jeder Winkel von Geheimnissen durchdrungen ist, sucht ein unermüdlicher Detektiv nach der Wahrheit.",
          "Obwohl die Schatten der Vergangenheit unheilvoll über den Ruinen liegen, leuchtet der Funke des Neuanfangs in den Augen eines Träumers.",
          "Mit der Präzision eines erfahrenen Meisters enthüllt ein Künstler in seinen Gemälden die tiefen, unergründlichen Facetten der menschlichen Seele.",
          "Die unerbittliche Kälte eines frostigen Abends wird nur von der flammenden Leidenschaft eines jungen Poeten durchbrochen, der seine Worte wie Feuer in die Nacht schickt.",
          "In den verlassenen Gassen einer historischen Stadt, in der die Zeit stillzustehen scheint, werden die Geheimnisse einer verlorenen Ära behutsam offenbart.",
          "Während der stürmische Wind die Dächer der alten Häuser zum Beben bringt, kämpft ein entschlossener Held gegen die Dunkelheit, die seine Welt bedroht.",
          "Die unendlichen Weiten des nächtlichen Himmels inspirieren einen Schriftsteller, dessen Worte die Grenzen zwischen Traum und Wirklichkeit auflösen.",
          "Obwohl die Straßen von den Schatten vergangener Zeiten heimgesucht werden, erstrahlt das Licht der Hoffnung in den Herzen derer, die daran glauben.",
          "Mit jeder Zeile, die ein alter Dichter schreibt, erwacht ein Hauch der Vergangenheit zum Leben und erzählt von vergessenen Heldentaten.",
          "In einem verfallenen Schloss, das von Legenden umwoben ist, findet ein junger Abenteurer den Schlüssel zu einem unerwarteten Geheimnis.",
          "Die funkelnden Sterne am dunklen Firmament scheinen die verlorenen Träume der Menschheit zu bewahren und sie in einem silbernen Licht zu umhüllen.",
          "Während ein kalter Wind die blühenden Wiesen überzieht, enthüllt ein alter Wanderer in seinen Geschichten die unvergängliche Schönheit der Natur.",
          "In den Tiefen einer verlassenen Mine, wo das Echo vergangener Tage widerhallt, entdeckt ein mutiger Forscher die Schätze der Erde.",
          "Obwohl der Tag sich dem Ende zuneigt, bringt die sanfte Melodie eines fernen Liedes Trost und Zuversicht in die Herzen der Menschen.",
          "Mit unerbittlicher Entschlossenheit bahnt sich ein Held seinen Weg durch ein Labyrinth aus Intrigen und dunklen Geheimnissen.",
          "Die dichten Nebelschwaden, die über das Land ziehen, verbergen die Spuren einer längst vergessenen Zivilisation, die nur darauf wartet, entdeckt zu werden.",
          "Während der Regen in silbernen Tropfen vom Himmel fällt, erinnert ein weiser Geschichtenerzähler an die Macht der Erinnerungen.",
          "Die glühenden Farben eines Sonnenuntergangs verschmelzen mit den Schatten der Nacht, während ein einsamer Wanderer seinen Weg ins Unbekannte findet.",
          "In einem alten Theater, in dem einst große Dramen aufgeführt wurden, hallen noch immer die Echos vergangener Emotionen wider.",
          "Obwohl die Welt von Chaos und Dunkelheit überschattet wird, erhebt sich der Geist der Hoffnung in den stillen Augen eines Kindes.",
          "Mit jeder verstreichenden Stunde enthüllt sich ein neues Mosaik aus Licht und Schatten, das die Seele tief berührt.",
          "Die melancholischen Klänge eines einsamen Saxophons erfüllen die verlassene Gasse und erzählen von verlorener Liebe und Sehnsucht.",
          "In den verwitterten Archiven einer alten Bibliothek werden die Geheimnisse der Menschheit bewahrt, bereit, von neugierigen Geistern entschlüsselt zu werden.",
          "Während der kalte Mond am Himmel thront, tanzen die Schatten der Vergangenheit auf den Pflastersteinen einer stillen Stadt.",
          "Die verhängnisvolle Stille einer verlassenen Straße wird nur durch das entfernte Rauschen eines Flusses durchbrochen, der von alten Legenden erzählt.",
          "Obwohl der Frost die Landschaft in ein glitzerndes Wunderland verwandelt, sucht ein einsamer Reisender nach der Wärme vergangener Zeiten.",
          "Mit der Präzision eines Uhrwerks enthüllt ein alter Chronist in seinen Aufzeichnungen die geheimen Rhythmen der Zeit.",
          "Die schattenhaften Konturen eines verfallenen Gebäudes erzählen von einer Ära, in der Heldentum und Tragik untrennbar miteinander verbunden waren.",
          "Während der Wind durch die zerfallenen Mauern eines alten Forts pfeift, wird das Echo vergangener Schlachten lebendig.",
          "In den dunklen Tiefen eines alten Waldes, wo jedes Geräusch eine Geschichte birgt, findet ein Suchender den Schlüssel zur Wahrheit.",
          "Obwohl die Sterne über einer stillen Landschaft wachen, entfaltet sich ein Drama, das nur die Nacht zu erzählen vermag.",
          "Die elegante Bewegung eines Panthers, der lautlos durch das Dickicht schleicht, verkörpert die Raffinesse und Effizienz natürlicher Überlebensstrategien.",
          "Die synchronisierten Sprünge einer Gazelle, die in einem anmutigen Ballett vor einem Raubtier flieht, illustrieren evolutionäre Raffinesse und Überlebensinstinkt.",
          "In den unzugänglichen Tiefen eines tropischen Regenwaldes zeigt sich die beeindruckende Vielfalt an Arten, die in einem fragilen ökologischen Gleichgewicht existieren.",
          "Die ausgeklügelten Tarnmechanismen zahlreicher Tierarten ermöglichen es ihnen, sich nahezu unsichtbar an ihre Umgebung anzupassen und so ihre Überlebenschancen zu maximieren.",
          "Die koordinierte Flucht von Beutetieren in einem Schwarm demonstriert ein ausgeklügeltes System kollektiver Überlebensstrategien, das die Natur in ihrer Komplexität widerspiegelt.",
          "Die kunstvoll orchestrierten Lautäußerungen von Walen, die als Kommunikationsmittel dienen, sind ein faszinierendes Zeugnis tierischer Intelligenz.",
          "Der majestätische Flug eines Adlers, der hoch über weiten Landschaften kreist, symbolisiert die unendliche Freiheit und Stärke der Natur.",
          "Die ausgefeilten Überlebensstrategien, die von komplexen Tarnmechanismen bis zu synchronisierten Fluchtbewegungen reichen, zeugen von der evolutionären Kreativität der Tierwelt.",
          "In den weiten Ebenen der Savanne demonstriert die rasche Flucht einer Gazelle vor einem Raubtier einen hochentwickelten Überlebensinstinkt, der das Wesen der Natur prägt.",
          "Die außergewöhnliche Anpassungsfähigkeit der Tiere an extreme Umweltbedingungen spiegelt die unermüdliche Kraft der Evolution wider.",
          "Durch die komplexen sozialen Strukturen in Tierherden wird ein ausgeprägtes System von Kooperation und Kommunikation sichtbar.",
          "Die natürliche Eleganz der Tierwelt, sichtbar in den harmonischen Bewegungen eines Schwans, verkörpert die unberührte Schönheit der Natur.",
          "Die kunstvollen Balzrituale vieler Vogelarten zeugen von einem tiefen, instinktiven Verständnis für die Bedeutung von Partnerschaft und Fortpflanzung.",
          "Die synchronisierten Flugmuster eines Vogelschwarmes, die den Himmel in ein atemberaubendes Farbspektakel tauchen, demonstrieren die kollektive Intelligenz und den Zusammenhalt der Tierwelt."
        ],
        hard: [
          "In den unendlichen Weiten der afrikanischen Savanne demonstriert die komplexe Sozialstruktur der Elefantenherde ein beeindruckendes Maß an Kommunikation und Zusammenhalt.",
          "Die majestätische Elefantenherde zieht in harmonischer Formation durch die Ebenen, während die Ältesten das Wissen über Generationen weitergeben.",
          "Im dichten Dschungel offenbart der Leopard durch seine lautlose Bewegung eine evolutionäre Raffinesse, die ihn zum Inbegriff der Tarnung erhebt.",
          "Die farbenprächtigen Balzrituale zahlreicher Vogelarten zeugen von einer ausgeklügelten kulturellen Vielfalt, die die Tierwelt in all ihren Facetten widerspiegelt.",
          "Das Chamäleon passt sich mit verblüffender Präzision an wechselnde Umgebungsbedingungen an, indem es seine Farbe dynamisch ändert.",
          "Die synchronen Bewegungen eines Fischschwarms, die ein lebendiges Farbenspiel im Ozean kreieren, illustrieren ein kollektives Verhalten von höchster Raffinesse.",
          "In den tiefsten Regionen des Ozeans erzeugen biolumineszente Kreaturen ein atemberaubendes Schauspiel, das die Grenzen zwischen Licht und Dunkelheit verwischt.",
          "Der majestätische Adler, der hoch oben am Himmel kreist, symbolisiert Freiheit und die unendliche Weite der Natur in ihrer reinsten Form.",
          "Die ausgeklügelte Kommunikationsfähigkeit von Walen, die in komplexen Gesängen ihre Emotionen und Botschaften über weite Entfernungen senden, zeugt von tierischer Intelligenz.",
          "Die evolutionäre Anpassungsfähigkeit von Tieren in arktischen Regionen, die trotz extremen Wetters überleben, ist ein beeindruckendes Zeugnis natürlicher Widerstandskraft.",
          "Im Korallenriff formen farbenprächtige Korallen ein schillerndes Unterwasserparadies, in dem zahlreiche Fischarten in einem fragilen Gleichgewicht leben.",
          "Die lautlose Jagd eines Panthers im dichten Dschungel demonstriert eine evolutionäre Raffinesse, die ihn zum Inbegriff der Tarnung erhebt.",
          "Die kunstvoll organisierten Nester zahlreicher Vogelarten zeugen von einer perfekten Symbiose aus Instinkt, Kreativität und architektonischem Können.",
          "Die synchronen Aktivitäten eines Bienenschwarms, der in beeindruckender Präzision Nektar sammelt, illustrieren ein hohes Maß an kollektiver Intelligenz.",
          "In den Tiefen tropischer Gewässer enthüllen biolumineszente Organismen ein magisches Lichtspiel, das die Grenzen zwischen Realität und Traum auflöst.",
          "Die langwierige Migration von Walen über tausende Kilometer zeugt von einem tief verwurzelten, instinktiven Verständnis der Meeresumgebungen.",
          "Die komplexen sozialen Strukturen in Wolfsrudeln, in denen Weisheit und Erfahrung von den Ältesten weitergegeben werden, demonstrieren kollektive Intelligenz auf höchstem Niveau.",
          "Die kunstvoll choreografierten Balzrituale zahlreicher Vogelarten offenbaren eine kulturelle Vielfalt, die ihresgleichen sucht.",
          "Der eindrucksvolle Blick eines Luchses, der in verschneiten Wäldern auf Beute lauert, zeugt von einer raffinierten Kombination aus Instinkt und Präzision.",
          "Die nahezu unsichtbare Anpassungsfähigkeit eines Chamäleons an seine Umgebung illustriert evolutionäre Meisterschaft in der Tarnung.",
          "Die synchronisierten Bewegungen eines Vogelschwarmes, die den Himmel in ein lebendiges Mosaik verwandeln, zeugen von kollektiver Intelligenz und Harmonie.",
          "In einem mystischen Wald, wo jedes Rascheln eine Geschichte erzählt, offenbart sich die subtile Schönheit der Tierwelt in ihrer ganzen Vielfalt.",
          "Die langwierige Migration von Zugvögeln über Kontinente hinweg ist ein beeindruckendes Phänomen, das von instinktiver Navigation und Überlebenswillen geprägt ist.",
          "Die ausgeklügelten Überlebensstrategien von Beutetieren, die durch koordinierte Fluchtmanöver ihre Chancen maximieren, sind ein Zeugnis evolutionärer Innovation.",
          "Die architektonisch beeindruckenden Bauten von Bibern zeugen von hoher Intelligenz und kooperativem, instinktiv gesteuertem Verhalten.",
          "Subtile Veränderungen in den Lautäußerungen von Walen, die ihre emotionale Verfassung widerspiegeln, offenbaren ein ausgeprägtes Maß an Sensibilität.",
          "Die schimmernden Schuppen eines exotischen Fisches, die das Sonnenlicht in einem atemberaubenden Farbenspiel reflektieren, demonstrieren natürliche Ästhetik auf höchstem Niveau.",
          "Die komplexen Balzrituale von Insektenarten zeugen von einer überraschenden Vielfalt an Kommunikationsformen in der Natur.",
          "Der elegante Tanz eines Schmetterlings, der von Blume zu Blume flattert, ist ein lebendiger Beweis für die Zerbrechlichkeit und Schönheit der Natur.",
          "Die synchronisierten Sprünge einer Gazelle, die in einem anmutigen Ballett vor einem Raubtier flieht, illustrieren evolutionäre Raffinesse und Überlebensinstinkt.",
          "In den unzugänglichen Tiefen eines tropischen Regenwaldes zeigt sich die beeindruckende Vielfalt an Arten, die in einem fragilen ökologischen Gleichgewicht existieren.",
          "Die ausgeklügelten Tarnmechanismen zahlreicher Tierarten ermöglichen es ihnen, sich nahezu unsichtbar an ihre Umgebung anzupassen und so ihre Überlebenschancen zu maximieren.",
          "Die koordinierte Flucht von Beutetieren in einem Schwarm demonstriert ein ausgeklügeltes System kollektiver Überlebensstrategien, das die Natur in ihrer Komplexität widerspiegelt.",
          "Die kunstvoll orchestrierten Lautäußerungen von Walen, die als Kommunikationsmittel dienen, sind ein faszinierendes Zeugnis tierischer Intelligenz.",
          "Der majestätische Flug eines Adlers, der hoch über weiten Landschaften kreist, symbolisiert die unendliche Freiheit und Stärke der Natur.",
          "Die ausgefeilten Überlebensstrategien, die von komplexen Tarnmechanismen bis zu synchronisierten Fluchtbewegungen reichen, zeugen von der evolutionären Kreativität der Tierwelt.",
          "In den weiten Ebenen der Savanne demonstriert die rasche Flucht einer Gazelle vor einem Raubtier einen hochentwickelten Überlebensinstinkt, der das Wesen der Natur prägt.",
          "Die außergewöhnliche Anpassungsfähigkeit der Tiere an extreme Umweltbedingungen spiegelt die unermüdliche Kraft der Evolution wider.",
          "Durch die komplexen sozialen Strukturen in Tierherden wird ein ausgeprägtes System von Kooperation und Kommunikation sichtbar.",
          "Die natürliche Eleganz der Tierwelt, sichtbar in den harmonischen Bewegungen eines Schwans, verkörpert die unberührte Schönheit der Natur.",
          "Die kunstvollen Balzrituale vieler Vogelarten zeugen von einem tiefen, instinktiven Verständnis für die Bedeutung von Partnerschaft und Fortpflanzung.",
          "Die synchronisierten Flugmuster eines Vogelschwarmes, die den Himmel in ein atemberaubendes Farbspektakel tauchen, demonstrieren die kollektive Intelligenz und den Zusammenhalt der Tierwelt."
        ]
      },
      realschule: {
        easy: [
          "Der Schüler lernt täglich in der Realschule.",
          "Schüler entwickeln ein tiefgreifendes Verständnis für Bildung."
          // Weitere Sätze können hier ergänzt werden…
        ],
        normal: [
          "Im Realschulunterricht werden theoretische Konzepte mit praxisnahen Anwendungen verknüpft, um den Schülern ein umfassendes Verständnis zu vermitteln.",
          "Schüler entwickeln ein tiefgreifendes Verständnis für die Bedeutung von Bildung als Grundlage für eine erfolgreiche Zukunft."
          // Weitere Sätze…
        ],
        hard: [
          "Die Realschule implementiert einen anspruchsvollen Lehrplan, der theoretische Konzepte mit praxisorientierten Projekten verknüpft, um den Schülern ein fundiertes Verständnis komplexer Zusammenhänge zu vermitteln.",
          "Die enge Zusammenarbeit zwischen verschiedenen Fachbereichen fördert ein umfassendes Verständnis der globalen Zusammenhänge."
          // Weitere Sätze…
        ]
      },
      gymnasium: {
        easy: [
          "Der Schüler liest ein anspruchsvolles Buch.",
          "Die Lehrerin erklärt komplexe Themen geduldig.",
          "Im Unterricht diskutieren die Schüler lebhaft über philosophische Fragen."
          // Weitere Sätze…
        ],
        normal: [
          "Im Gymnasium wird ein anspruchsvoller Lehrplan verfolgt, der klassische und moderne Bildungselemente miteinander verknüpft.",
          "Schüler analysieren literarische Werke und gewinnen dadurch ein tiefes Verständnis für kulturelle Hintergründe."
          // Weitere Sätze…
        ],
        hard: [
          "Im Gymnasium wird ein rigoroser Lehrplan verfolgt, der die Schüler dazu anregt, tiefgreifende Analysen literarischer, historischer und naturwissenschaftlicher Phänomene durchzuführen.",
          "Die intensive Auseinandersetzung mit klassischen Texten fördert ein kritisches Verständnis der kulturellen Wurzeln moderner Gesellschaften."
          // Weitere Sätze…
        ]
      },
      medizin: {
        easy: [
          "Der Arzt untersucht den Patienten.",
          "Die Krankenschwester reicht dem Patienten das Medikament."
          // Weitere Sätze…
        ],
        normal: [
          "In der modernen Klinik werden fortschrittliche Diagnoseverfahren eingesetzt, um die Gesundheit der Patienten präzise zu beurteilen.",
          "Die interdisziplinäre Zusammenarbeit optimiert den Behandlungsprozess."
          // Weitere Sätze…
        ],
        hard: [
          "In hochmodernen Forschungslabors werden neuartige therapeutische Ansätze entwickelt, die auf der präzisen Analyse genetischer Daten basieren.",
          "Die personalisierte Medizin revolutioniert die Behandlung schwerer Erkrankungen durch individuelle genetische Profile."
          // Weitere Sätze…
        ]
      },
      bank: {
        easy: [
          "Der Kunde betritt die Bank.",
          "Die Bank ist modern und einladend."
          // Weitere Sätze…
        ],
        normal: [
          "Die Bank bietet ein breites Spektrum moderner Finanzdienstleistungen an.",
          "Kunden profitieren von persönlicher Beratung und digitalen Services."
          // Weitere Sätze…
        ],
        hard: [
          "In einem global vernetzten Finanzsystem nutzt die Bank fortschrittliche Analysemethoden, um komplexe Marktbewegungen präzise zu prognostizieren.",
          "Die Integration von Big-Data-Technologien ermöglicht eine detaillierte Risikoanalyse."
          // Weitere Sätze…
        ]
      },
      tierwelt: {
        easy: [
          "Der Hund bellt im Garten.",
          "Die Katze jagt eine Maus."
          // Weitere Sätze…
        ],
        normal: [
          "In der afrikanischen Savanne demonstriert die Giraffe ihre beeindruckende Anpassungsfähigkeit.",
          "Die synchronisierten Bewegungen eines Fischschwarms illustrieren kollektives Verhalten."
          // Weitere Sätze…
        ],
        hard: [
          "In den unendlichen Weiten der afrikanischen Savanne demonstriert die komplexe Sozialstruktur der Elefantenherde ein beeindruckendes Maß an Kommunikation.",
          "Die synchronisierten Flugmuster eines Vogelschwarmes tauchen den Himmel in ein atemberaubendes Farbspektakel."
          // Weitere Sätze…
        ]
      },
      code_python: {
        easy: [
          "print('Hello, World!')",
          "message = 'Python rocks!'"
        ],
        normal: [
          "def add(x, y): return x + y",
          "def fibonacci(n):\n    a, b = 0, 1\n    for _ in range(n):\n        a, b = b, a + b\n    return a"
        ],
        hard: [
          "def complex_function(x):\n    return [i for i in range(x) if i % 2 == 0]\nprint(complex_function(10))",
          "try:\n    import non_existent_module\nexcept ImportError:\n    print('Modul nicht gefunden!')"
        ]
      }
    };

    // Englische Copy-Sätze – (bei Kategorie "tierwelt" wird zu "animalworld" gewechselt)
    const sentenceLibraries_en = {
      standard: {
        easy: [
          "The dog runs fast.",
          "The sun sets slowly."
        ],
        normal: [
          "A majestic eagle soars high in the azure sky, inspiring everyone who watches it.",
          "The gentle caress of a cool breeze brings the scent of spring directly to your heart."
        ],
        hard: [
          "Amidst a raging storm, a lone hero makes his way through the scattered ruins of an abandoned city as the wind howls relentlessly.",
          "The synchronized flight patterns of a flock of birds, turning the sky into a breathtaking spectacle, demonstrate the collective intelligence and unity of the animal kingdom."
        ]
      },
      animalworld: {
        easy: [
          "The dog barks in the garden.",
          "The antelope jumps gracefully across the open field."
        ],
        normal: [
          "In the African savannah, the giraffe demonstrates impressive adaptability with its long stride and elegant movements.",
          "The synchronized movements of a school of fish illustrate a remarkable collective behavior that transcends the individual."
        ],
        hard: [
          "Across the vast African plains, the complex social structure of an elephant herd showcases an impressive level of communication and unity.",
          "The coordinated flight of a flock of birds, turning the sky into a dazzling spectacle, exemplifies the collective intelligence and cohesion of the animal world."
        ]
      }
    };

    // Swahili Copy-Sätze – (bei Kategorie "tierwelt" wird zu "wanyama" gewechselt)
    const sentenceLibraries_sw = {
      standard: {
        easy: [
          "Mbwa anakimbia haraka.",
          "Jua linazama polepole."
        ],
        normal: [
          "Tai wa heshima wanapaa juu angani ya buluu, wakiwahamasisha watu wote.",
          "Mwanga wa jua unaleta utulivu moyoni mwa watu."
        ],
        hard: [
          "Katikati ya dhoruba kali, shujaa mmoja anapitia mabaki ya mji uliotapakaa wakati upepo unavuma kwa nguvu.",
          "Mifumo ya ndege inayopaa kwa usawa inaonesha umoja wa kweli wa jamii ya wanyama."
        ]
      },
      wanyama: {
        easy: [
          "Mbwa analia bustani.",
          "Paka analia kwa upole."
        ],
        normal: [
          "Katika savanna ya Afrika, twiga inaonyesha uwezo mkubwa wa kustahimili joto na baridi.",
          "Mienendo ya wanyama katika hifadhi inaonesha umoja wa kipekee kati ya viumbe mbalimbali."
        ],
        hard: [
          "Katika maeneo ya mbali ya Afrika, muundo wa kijamii wa wanyama unaonesha kiwango cha juu cha mawasiliano na umoja.",
          "Mwingiliano wa ndege wakati wa kuruka unaonesha ufanisi na umoja wa jamii ya wanyama."
        ]
      }
    };

    let boss = null, bossDefeated = false;
    let lastProcessedIndex = 0;
    let lastHotStreakWordCount = 0;
    
    function calculateSessionScore(words, errorCount, wpm, sessionDuration) {
      let baseScore = words * 10;
      let errorPenalty = errorCount * 5;
      let targetWPM = 40;
      let tempoBonus = (wpm > targetWPM) ? Math.round((wpm - targetWPM) * 2) : 0;
      let timeBonus = sessionDuration < 120 ? 20 : 0;
      let finalScore = baseScore + tempoBonus + timeBonus - errorPenalty;
      return finalScore > 0 ? finalScore : 0;
    }
    
    function getPlayerRank() {
      if (userStats.xp < 500) return "Bronze";
      if (userStats.xp < 1000) return "Silber";
      return "Gold";
    }
    
    function updateProfileUI() {
      const profileImgElem = document.getElementById("profileImage");
      const playerNameElem = document.getElementById("playerName");
      const playerWissenspunkteElem = document.getElementById("playerWissenspunkte");
      profileImgElem.src = userStats.profileImage || "https://via.placeholder.com/80";
      playerNameElem.innerHTML = `${userStats.playerName} <span class="rank-badge">${getPlayerRank()}</span>`;
      playerWissenspunkteElem.textContent = "Wissenspunkte: " + userStats.wissenspunkte;
    }
    
    function showSessionResults(words, wpm, apm, errorCount, sessionScore) {
      let rank = getPlayerRank();
      let bonusWissenspunkte = Math.round(sessionScore / 10);
      let resultHTML = `
        <h2>${currentLanguage === 'de' ? "Session beendet!" : (currentLanguage === 'en' ? "Session Ended!" : "Muda Umekwisha!")}</h2>
        <p>${currentLanguage === 'de' ? "Spieler:" : (currentLanguage === 'en' ? "Player:" : "Mchezaji:")} ${userStats.playerName} – ${currentLanguage === 'de' ? "Rang:" : (currentLanguage === 'en' ? "Rank:" : "Cheo:")} ${rank}</p>
        <p>${currentLanguage === 'de' ? "Wörter:" : (currentLanguage === 'en' ? "Words:" : "Maneno:")} ${words}</p>
        <p>${currentLanguage === 'de' ? "WPM:" : (currentLanguage === 'en' ? "WPM:" : "Maneno kwa Dakika:")} ${wpm}</p>
        <p>${currentLanguage === 'de' ? "APM:" : (currentLanguage === 'en' ? "APM:" : "Mabofya kwa Dakika:")} ${apm}</p>
        <p>${currentLanguage === 'de' ? "Fehler:" : (currentLanguage === 'en' ? "Errors:" : "Makosa:")} ${errorCount}</p>
        <p>${currentLanguage === 'de' ? "Session Score:" : (currentLanguage === 'en' ? "Session Score:" : "Alama za Muda:")} ${sessionScore}</p>
        <p>${currentLanguage === 'de' ? "Bonus Wissenspunkte:" : (currentLanguage === 'en' ? "Bonus Knowledge Points:" : "Alama za Ziada:")} ${bonusWissenspunkte}</p>
        <button onclick="closeResultsPopup()">${currentLanguage === 'de' ? "Schließen" : (currentLanguage === 'en' ? "Close" : "Funga")}</button>
      `;
      endSessionPopup.innerHTML = resultHTML;
      endSessionPopup.style.display = "block";
    }
    
    function closeResultsPopup() {
      endSessionPopup.style.display = "none";
    }
    
    function rollBonus() {
      return Math.floor(Math.random() * (50 - 3 + 1)) + 3;
    }
    
    function checkHotStreakBonus() {
      const HOT_STREAK_THRESHOLD = 8;
      if (hotStreakCounter >= HOT_STREAK_THRESHOLD) {
        let bonus = rollBonus();
        showDicePopup(bonus);
        hotStreakCounter = 0;
        return bonus;
      }
      return 0;
    }
    
    function showDicePopup(bonus) {
      const dicePopup = document.createElement("div");
      dicePopup.innerHTML = `<div class="dice-animation">${bonus}</div>`;
      dicePopup.style.position = "fixed";
      dicePopup.style.top = "50%";
      dicePopup.style.left = "50%";
      dicePopup.style.transform = "translate(-50%, -50%)";
      dicePopup.style.background = "rgba(0,0,0,0.8)";
      dicePopup.style.color = "#fff";
      dicePopup.style.padding = "20px";
      dicePopup.style.borderRadius = "10px";
      dicePopup.style.fontSize = "2em";
      dicePopup.style.zIndex = "500";
      document.body.appendChild(dicePopup);
      setTimeout(() => {
        dicePopup.classList.add("fade-out");
        setTimeout(() => { document.body.removeChild(dicePopup); }, 1000);
      }, 2000);
    }
    
    function renderShop() {
      const shopProfileSection = document.getElementById("shopProfileSection");
      shopProfileSection.innerHTML = "<h3>Profilbilder</h3>";
      shopProfileItems.forEach(item => {
        const btn = document.createElement("button");
        btn.id = "shop_" + item.id;
        if (userStats.inventory.profileImages && userStats.inventory.profileImages.includes(item.imgUrl)) {
          btn.disabled = true;
          btn.innerHTML = `<img src="${item.imgUrl}" style="width:32px; vertical-align:middle;"> Gekauft`;
        } else {
          btn.innerHTML = `<img src="${item.imgUrl}" style="width:32px; vertical-align:middle;"> ${item.price} Wissenspunkte`;
          btn.onclick = () => purchaseItem(item, "profile");
        }
        shopProfileSection.appendChild(btn);
      });
      const shopGluecksbringerSection = document.getElementById("shopGluecksbringerSection");
      shopGluecksbringerSection.innerHTML = "<h3>Glücksbringer</h3>";
      shopGluecksbringerItems.forEach(item => {
        const btn = document.createElement("button");
        btn.id = "shop_" + item.id;
        if (userStats.inventory.gluecksbringer && userStats.inventory.gluecksbringer.includes(item.imgUrl)) {
          btn.disabled = true;
          btn.innerHTML = `<img src="${item.imgUrl}" style="width:32px; vertical-align:middle;"> Gekauft`;
        } else {
          btn.innerHTML = `<img src="${item.imgUrl}" style="width:32px; vertical-align:middle;"> ${item.price} Wissenspunkte`;
          btn.onclick = () => purchaseItem(item, "gluecksbringer");
        }
        shopGluecksbringerSection.appendChild(btn);
      });
    }
    
    function purchaseItem(item, type) {
      if (userStats.wissenspunkte >= item.price) {
        userStats.wissenspunkte -= item.price;
        if (type === "profile") {
          userStats.profileImage = item.imgUrl;
          userStats.inventory.profileImages = userStats.inventory.profileImages || [];
          if (!userStats.inventory.profileImages.includes(item.imgUrl)) {
            userStats.inventory.profileImages.push(item.imgUrl);
          }
          unlockReward(`Profilbild ${item.id} freigeschaltet!`);
        } else if (type === "gluecksbringer") {
          document.getElementById("writeArea").style.cursor = "url('" + item.imgUrl + "'), auto";
          userStats.inventory.gluecksbringer = userStats.inventory.gluecksbringer || [];
          if (!userStats.inventory.gluecksbringer.includes(item.imgUrl)) {
            userStats.inventory.gluecksbringer.push(item.imgUrl);
          }
          unlockReward(`Glücksbringer ${item.id} freigeschaltet!`);
        }
        updateProfileUI();
        renderInventory();
        renderShop();
        alert(`${item.id} wurde erfolgreich gekauft!`);
      } else {
        alert(currentLanguage === 'de' ? "Nicht genügend Wissenspunkte! Verdiene mehr XP und Wissenspunkte, indem du weiterschreibst." : (currentLanguage === 'en' ? "Not enough Knowledge Points! Earn more XP and points by writing." : "Hatutoshi alama za maarifa! Pata XP zaidi kwa kuandika."));
      }
    }
    
    function renderInventory() {
      const container = document.getElementById("inventoryContainer");
      container.innerHTML = "<h2>Inventar</h2>";
      let profileDiv = document.createElement("div");
      profileDiv.innerHTML = "<h3>Profilbilder</h3>";
      userStats.inventory.profileImages = userStats.inventory.profileImages || [];
      userStats.inventory.profileImages.forEach(imgUrl => {
        let img = document.createElement("img");
        img.src = imgUrl;
        img.style.width = "50px";
        img.style.marginRight = "5px";
        img.style.cursor = "pointer";
        img.title = "Klicke, um dieses Profilbild auszuwählen";
        img.onclick = () => {
          userStats.profileImage = imgUrl;
          updateProfileUI();
          renderInventory();
        };
        profileDiv.appendChild(img);
      });
      container.appendChild(profileDiv);
      let gluecksbringerDiv = document.createElement("div");
      gluecksbringerDiv.innerHTML = "<h3>Glücksbringer</h3>";
      userStats.inventory.gluecksbringer = userStats.inventory.gluecksbringer || [];
      userStats.inventory.gluecksbringer.forEach(curUrl => {
        let img = document.createElement("img");
        img.src = curUrl;
        img.style.width = "50px";
        img.style.marginRight = "5px";
        img.style.cursor = "pointer";
        img.title = "Klicke, um diesen Glücksbringer auszuwählen";
        img.onclick = () => {
          document.getElementById("writeArea").style.cursor = "url('" + curUrl + "'), auto";
        };
        gluecksbringerDiv.appendChild(img);
      });
      container.appendChild(gluecksbringerDiv);
    }
    
    function generateProfileChecksum(stats) {
      return generateHash(stats.wissenspunkte.toString() + JSON.stringify(stats.inventory.gluecksbringer) + secretKey);
    }

    function saveProfile() {
      const profileChecksum = generateHash(userStats.wissenspunkte.toString() + secretKey);
      userStats.profileChecksum = generateProfileChecksum(userStats);
      const data = JSON.stringify(userStats, null, 2);
      const blob = new Blob([data], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "profile.json";
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        URL.revokeObjectURL(url);
        a.remove();
      }, 100);
    }

    function loadProfile(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const loadedProfile = JSON.parse(e.target.result);
          const expectedChecksum = generateProfileChecksum(loadedProfile);
          if (loadedProfile.profileChecksum !== expectedChecksum) {
            alert("Profilprüfung fehlgeschlagen! Möglicher Betrugsversuch!");
            return;
          }
          userStats = loadedProfile;
          updateXPAndLevelDisplay();
          updateProfileUI();
          renderInventory();
          renderShop();
          alert("Profil erfolgreich geladen.");
        } catch (error) {
          alert("Fehler beim Laden des Profils: " + error);
        }
      };
      reader.readAsText(file);
    }

    function updateXPAndLevelDisplay() {
      xpDisplay.textContent = `XP: ${userStats.xp}`;
      levelDisplay.textContent = `Level: ${userStats.level}`;
    }

    function checkLevelUp() {
      const newLevel = Math.floor(userStats.xp / 100) + 1;
      if (newLevel > userStats.level) {
        userStats.level = newLevel;
        alert(currentLanguage === 'de' ? `Level Up! Du bist jetzt Level ${newLevel}.` : (currentLanguage === 'en' ? `Level Up! You are now level ${newLevel}.` : `Kiwango kimepanda! Umefikia kiwango cha ${newLevel}.`));
        userStats.wissenspunkte += 50;
        if (newLevel === 2) { unlockReward("😀 Emoji Profil"); }
        if (newLevel === 3) { unlockReward("😎 Cool Emoji"); }
        if (newLevel === 4) { unlockReward("🔥 Hot Emoji"); }
        if (newLevel === 5) { unlockReward("🏆 Champion Emoji"); }
      }
      updateXPAndLevelDisplay();
      updateProfileUI();
    }

    function saveSessionToLeaderboard() {
      const currentWords = countWords(writeArea.innerText);
      const sessionData = { words: currentWords, xp: userStats.xp, timestamp: Date.now() };
      leaderboard.push(sessionData);
      leaderboard.sort((a, b) => b.words - a.words);
      localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
    }

    function updateLeaderboard() {
      const leaderboardBody = document.getElementById("leaderboardBody");
      leaderboardBody.innerHTML = "";
      leaderboard.slice(0, 10).forEach((session, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${index + 1} ⭐</td><td>${session.words} ✍️</td><td>${session.xp} 🏆</td>`;
        leaderboardBody.appendChild(row);
      });
    }

    function shareResults() {
      const summary = `${currentLanguage === 'de' ? "Schreibabenteuer DemusOpalium Ergebnisse:" : (currentLanguage === 'en' ? "Writing Adventure DemusOpalium Results:" : "Matokeo ya Mchezo wa Kuandika DemusOpalium:")}\n${currentLanguage === 'de' ? "Wörter:" : (currentLanguage === 'en' ? "Words:" : "Maneno:")} ${countWords(writeArea.innerText)}\n${currentLanguage === 'de' ? "XP:" : (currentLanguage === 'en' ? "XP:" : "XP:")} ${userStats.xp}\n${currentLanguage === 'de' ? "Level:" : (currentLanguage === 'en' ? "Level:" : "Kiwango:")} ${userStats.level}`;
      navigator.clipboard.writeText(summary).then(() => { 
        alert(currentLanguage === 'de' ? "Ergebnisse kopiert!" : (currentLanguage === 'en' ? "Results copied!" : "Matokeo yamekunakili!")); 
      });
    }

    function unlockReward(reward) {
      if (!unlockedRewards.includes(reward)) {
        unlockedRewards.push(reward);
        alert(currentLanguage === 'de' ? "Reward freigeschaltet: " + reward : (currentLanguage === 'en' ? "Reward unlocked: " + reward : "Tuzo limetolewa: " + reward));
        localStorage.setItem("unlockedRewards", JSON.stringify(unlockedRewards));
        updateRewardUI();
      }
    }

    function updateRewardUI() {
      const rewardList = document.getElementById("rewardList");
      rewardList.innerHTML = "";
      unlockedRewards.forEach(r => {
        const li = document.createElement("li");
        li.textContent = r;
        rewardList.appendChild(li);
      });
    }

    /* --- Event Listener --- */
    document.getElementById("changeNameBtn").addEventListener("click", function() {
      const newName = document.getElementById("playerNameInput").value.trim();
      if (newName) {
        userStats.playerName = newName;
        updateProfileUI();
        alert(currentLanguage === 'de' ? "Name wurde geändert!" : (currentLanguage === 'en' ? "Name changed!" : "Jina limetabadilishwa!"));
      } else {
        alert(currentLanguage === 'de' ? "Bitte gib einen gültigen Namen ein." : (currentLanguage === 'en' ? "Please enter a valid name." : "Tafadhali ingiza jina halali."));
      }
    });

    document.getElementById("saveProfileBtn").addEventListener("click", saveProfile);
    document.getElementById("loadProfileBtn").addEventListener("click", () => { loadProfileInput.click(); });
    document.getElementById("loadProfileInput").addEventListener("change", loadProfile);

    document.getElementById("infoBtn").addEventListener("click", () => { document.getElementById("infoModal").style.display = "flex"; });
    document.getElementById("closeInfo").addEventListener("click", () => { document.getElementById("infoModal").style.display = "none"; });
    window.addEventListener("click", (event) => { 
      const infoModal = document.getElementById("infoModal");
      if (event.target === infoModal) { infoModal.style.display = "none"; }
    });
    document.getElementById("startBtn").addEventListener("click", () => { resetSession(); });
    document.getElementById("resetBtn").addEventListener("click", resetSession);
    document.getElementById("promptBtn").addEventListener("click", showRandomPrompt);
    document.getElementById("shareBtn").addEventListener("click", shareResults);
    document.getElementById("checkBtn").addEventListener("click", checkCopySentence);

    const modeSelect = document.getElementById("modeSelect");
    const timeSelect = document.getElementById("timeSelect");
    const difficultySelect = document.getElementById("difficultySelect");
    const writeArea = document.getElementById("writeArea");
    const timerDisplay = document.getElementById("timer");
    const wordCountDisplay = document.getElementById("wordCount");
    const goalProgressDisplay = document.getElementById("goalProgress");
    const xpDisplay = document.getElementById("xpDisplay");
    const levelDisplay = document.getElementById("levelDisplay");
    const wpmDisplay = document.getElementById("wpmDisplay");
    const apmDisplay = document.getElementById("apmDisplay");
    const hotStreakIndicator = document.getElementById("hotStreakIndicator");
    const achievementPopup = document.getElementById("achievementPopup");
    const copyTargetElem = document.getElementById("copyTarget");
    const targetSentenceElem = document.getElementById("targetSentence");
    const endSessionPopup = document.getElementById("endSessionPopup");
    let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
    let unlockedRewards = [];
    if (localStorage.getItem("unlockedRewards")) {
      unlockedRewards = JSON.parse(localStorage.getItem("unlockedRewards"));
      updateRewardUI();
    }
    let sessionAchievements = {};
    let copyAchieved = {};
    const prompts = [
      "Es war einmal ein geheimnisvoller Wald, in dem die Zeit stillzustehen schien...",
      "Als die Sonne hinter den Bergen verschwand, begann ein Abenteuer, das alles verändern sollte...",
      "Plötzlich ertönte ein seltsames Geräusch, und niemand wusste, was als Nächstes passieren würde...",
      "In einer Stadt, in der jeder Bewohner ein Geheimnis hatte, wurde ein unscheinbarer Brief gefunden..."
    ];
    const warningSound = new Audio('warning.mp3');
    
    function countWords(text) {
      return text.trim().split(/\s+/).filter(w => w.length > 0).length;
    }
    
    function updateTimerDisplay() {
      let min = Math.floor(remainingTime / 60);
      let sec = remainingTime % 60;
      timerDisplay.textContent = `Time: ${min}:${sec.toString().padStart(2, "0")}`;
    }
    
    function updateWordCount() {
      const text = writeArea.innerText;
      const count = countWords(text);
      wordCountDisplay.textContent = `Words: ${count}`;
      goalProgressDisplay.textContent = `Goal: ${count}/${window.baseTarget || "-"}`;
      if (modeSelect.value === "adventure" && boss) { updateBossStatus(); }
      if (modeSelect.value === "adventure" && boss) {
         if (count - lastHotStreakWordCount >= 8) {
             let bonus = rollBonus();
             boss.currentHealth = Math.max(boss.currentHealth - bonus, 0);
             updateBossUI();
             showDicePopup(bonus);
             lastHotStreakWordCount = count;
         }
      }
      for (let threshold in sessionAchievements) {
        if (count >= threshold && !sessionAchievements[threshold].achieved) {
          sessionAchievements[threshold].achieved = true;
          const achieveElem = document.getElementById("achieve" + threshold);
          if (achieveElem) { achieveElem.textContent = "Erreicht"; }
        }
      }
    }
    
    function updateWPM() {
      if (!sessionStartTime) return;
      const elapsedMinutes = (Date.now() - sessionStartTime) / 60000;
      const wpm = Math.round(countWords(writeArea.innerText) / elapsedMinutes);
      wpmDisplay.textContent = `WPM: ${wpm}`;
    }
    
    function updateAPM() {
      if (!sessionStartTime) return;
      const elapsedMinutes = (Date.now() - sessionStartTime) / 60000;
      const apm = elapsedMinutes > 0 ? Math.round(keyPressCount / elapsedMinutes) : 0;
      apmDisplay.textContent = `APM: ${apm} max`;
    }
    
    function resetIdleTimer() {
      clearTimeout(idleTimeout);
      let idleLimit = (difficultySelect.value === "easy") ? 3000 : (difficultySelect.value === "normal") ? 2000 : 1000;
      idleTimeout = setTimeout(triggerInactivityWarning, idleLimit);
      writeArea.classList.remove("warning");
    }
    
    function triggerInactivityWarning() {
      writeArea.classList.add("warning");
      playWarningSound();
      if (modeSelect.value === "hardcore") {
        setTimeout(() => {
          if (writeArea.classList.contains("warning")) {
            writeArea.innerText = "";
            updateWordCount();
          }
        }, 2000);
      }
    }
    
    function playWarningSound() {
      warningSound.play().catch(e => console.log("Sound konnte nicht abgespielt werden:", e));
    }
    
    function showRandomPrompt() {
      const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];
      writeArea.innerText = randomPrompt + "\n\n";
      updateWordCount();
    }
    
    function showAchievement(message) {
      achievementPopup.textContent = message;
      achievementPopup.style.display = "block";
      achievementPopup.classList.add("animate__bounceIn");
      setTimeout(() => {
        achievementPopup.classList.remove("animate__bounceIn");
        achievementPopup.style.display = "none";
      }, 3000);
    }
    
    function showHotStreakIndicator() {
      hotStreakIndicator.style.display = "block";
      hotStreakIndicator.classList.add("animate__flash");
      setTimeout(() => {
        hotStreakIndicator.classList.remove("animate__flash");
        hotStreakIndicator.style.display = "none";
      }, 2000);
      hotStreakCounter = 0;
    }
    
    /* --- Copy Challenge Funktionen --- */
    function generateCopySentence() {
      let lib = document.getElementById("librarySelect").value;
      let diff = difficultySelect.value;
      let sentences;
      // Falls Englisch und Kategorie "tierwelt" gewählt, auf "animalworld" umstellen
      if (currentLanguage === 'en' && lib === 'tierwelt') {
        lib = 'animalworld';
      }
      // Falls Swahili und Kategorie "tierwelt" gewählt, auf "wanyama" umstellen
      if (currentLanguage === 'sw' && lib === 'tierwelt') {
        lib = 'wanyama';
      }
      if (currentLanguage === 'de') {
        sentences = sentenceLibraries[lib][diff];
      } else if (currentLanguage === 'en') {
        sentences = sentenceLibraries_en[lib] ? sentenceLibraries_en[lib][diff] : sentenceLibraries[lib][diff];
      } else if (currentLanguage === 'sw') {
        sentences = sentenceLibraries_sw[lib] ? sentenceLibraries_sw[lib][diff] : sentenceLibraries[lib][diff];
      }
      let randomIndex = Math.floor(Math.random() * sentences.length);
      currentTargetSentence = sentences[randomIndex];
      targetSentenceElem.textContent = currentTargetSentence.trim();
      writeArea.innerText = "";
    }
    
    function checkCopySentence() {
      let userInput = writeArea.innerText.replace(/\n/g, " ").trim().toLowerCase();
      let target = currentTargetSentence.trim().toLowerCase();
      if (userInput === target) {
        let points = currentTargetSentence.split(" ").length * 10;
        copyScore += points;
        userStats.xp += points;
        userStats.wissenspunkte += points;
        showAchievement(currentLanguage === 'de' ? "Satz korrekt! +" + points + " Punkte." : (currentLanguage === 'en' ? "Sentence correct! +" + points + " points." : "Sentensi sahihi! +" + points + " pointi."));
        checkCopyAchievements();
        writeArea.innerText = "";
        updateCopyScoreDisplay();
        generateCopySentence();
      } else {
        showAchievement(currentLanguage === 'de' ? "Nicht exakt! Versuche es erneut." : (currentLanguage === 'en' ? "Not exactly! Try again." : "Sio sahihi! Jaribu tena."));
      }
    }
    
    function checkCopyAchievements() {
      if (copyScore >= 100 && !copyAchieved["100"]) {
         copyAchieved["100"] = true;
         showAchievement(currentLanguage === 'de' ? "Copy Challenge Bronze erreicht! (+100 Punkte)" : (currentLanguage === 'en' ? "Copy Challenge Bronze reached! (+100 points)" : "Copy Challenge Bronze imefikia! (+100 pointi)"));
         unlockReward("🥉 Copy-Challenge Bronze");
      }
      if (copyScore >= 200 && !copyAchieved["200"]) {
         copyAchieved["200"] = true;
         showAchievement(currentLanguage === 'de' ? "Copy Challenge Silber erreicht! (+200 Punkte)" : (currentLanguage === 'en' ? "Copy Challenge Silver reached! (+200 points)" : "Copy Challenge Silver imefikia! (+200 pointi)"));
         unlockReward("🥈 Copy-Challenge Silber");
      }
      if (copyScore >= 300 && !copyAchieved["300"]) {
         copyAchieved["300"] = true;
         showAchievement(currentLanguage === 'de' ? "Copy Challenge Gold erreicht! (+300 Punkte)" : (currentLanguage === 'en' ? "Copy Challenge Gold reached! (+300 points)" : "Copy Challenge Gold imefikia! (+300 pointi)"));
         unlockReward("🥇 Copy-Challenge Gold");
      }
    }
    
    function initCopyMode() {
      copyScore = 0;
      copyAchieved = {};
      generateCopySentence();
      copyTargetElem.style.display = "block";
      document.getElementById("checkBtn").style.display = "inline-block";
      document.getElementById("copyScoreDisplay").style.display = "block";
      writeArea.innerText = currentLanguage === 'de' ? "Drücke Enter, um das Spiel zu starten" : (currentLanguage === 'en' ? "Press Enter to start the game" : "Bonyeza Enter kuanza mchezo");
      waitingForStart = true;
      updateCopyScoreDisplay();
    }
    
    function updateCopyScoreDisplay() {
      document.getElementById("copyScoreDisplay").textContent = "Copy Score: " + copyScore;
    }
    
    function startSession() {
      endSessionPopup.style.display = "none";
      sessionActive = true;
      keyPressCount = 0;
      hotStreakCounter = 0;
      waitingForStart = false;
      let idleLimit = (difficultySelect.value === "easy") ? 3000 : (difficultySelect.value === "normal") ? 2000 : 1000;
      let thresholdTime = (difficultySelect.value === "easy") ? 250 : (difficultySelect.value === "normal") ? 200 : 150;
      hotStreakTimeThreshold = thresholdTime;
      idleTimeout = setTimeout(triggerInactivityWarning, idleLimit);
    
      const timeMode = parseInt(timeSelect.value);
      remainingTime = timeMode * 60;
      if (modeSelect.value !== "copy") {
        window.baseTarget = (difficultySelect.value === "easy") ? timeMode * 65 : (difficultySelect.value === "normal") ? timeMode * 85 : timeMode * 100;
        generateAchievements();
      } else {
        generateCopySentence();
      }
    
      if (modeSelect.value === "adventure") {
        initBoss();
        lastProcessedIndex = 0;
        lastHotStreakWordCount = countWords(writeArea.innerText);
      }
    
      updateTimerDisplay();
      updateWordCount();
      sessionStartTime = Date.now();
    
      timerInterval = setInterval(() => {
        remainingTime--;
        updateTimerDisplay();
        updateWPM();
        updateAPM();
        if (modeSelect.value === "adventure" && boss) { updateBossStatus(); }
        if (remainingTime <= 0) { 
          if (modeSelect.value !== "copy") {
            let words = countWords(writeArea.innerText);
            let wpm = Math.round(words / ((Date.now() - sessionStartTime) / 60000));
            let apm = Math.round(keyPressCount / ((Date.now() - sessionStartTime) / 60000));
            let errorCount = 0;
            let sessionDuration = Math.floor((Date.now() - sessionStartTime) / 1000);
            let sessionScore = calculateSessionScore(words, errorCount, wpm, sessionDuration);
            userStats.wissenspunkte += Math.round(sessionScore / 10);
            updateXPAndLevelDisplay();
            saveSessionToLeaderboard();
            updateLeaderboard();
            updateProfileUI();
            showSessionResults(words, wpm, apm, errorCount, sessionScore);
          }
          endSession();
        }
      }, 1000);
    }
    
    function resetSession() {
      clearInterval(timerInterval);
      clearTimeout(idleTimeout);
      sessionActive = false;
      remainingTime = parseInt(timeSelect.value) * 60;
      writeArea.innerText = currentLanguage === 'de' ? "Drücke Enter, um das Spiel zu starten" : (currentLanguage === 'en' ? "Press Enter to start the game" : "Bonyeza Enter kuanza mchezo");
      waitingForStart = true;
      updateTimerDisplay();
      updateWordCount();
      writeArea.classList.remove("warning");
      keyPressCount = 0;
      boss = null;
      bossDefeated = false;
      document.getElementById("bossContainer").style.display = "none";
      hotStreakIndicator.style.display = "none";
      copyTargetElem.style.display = "none";
      document.getElementById("checkBtn").style.display = "none";
      document.getElementById("copyScoreDisplay").style.display = "none";
      endSessionPopup.style.display = "none";
      
      if (modeSelect.value === "copy") {
        initCopyMode();
      }
    }
    
    function endSession() {
      clearInterval(timerInterval);
      clearTimeout(idleTimeout);
      sessionActive = false;
      
      if (modeSelect.value !== "copy") {
        // Ergebnis-Popup wird in showSessionResults() angezeigt
      } else {
        let message = currentLanguage === 'de' ? "Deine Copy Challenge Punkte: " + copyScore : (currentLanguage === 'en' ? "Your Copy Challenge score: " + copyScore : "Alama zako za Copy Challenge: " + copyScore);
        endSessionPopup.innerHTML = `<h2>${currentLanguage === 'de' ? "Session beendet!" : (currentLanguage === 'en' ? "Session Ended!" : "Muda umekwisha!")}</h2>
                                     <p>${message}</p>
                                     <button onclick="closeResultsPopup()">${currentLanguage === 'de' ? "Schließen" : (currentLanguage === 'en' ? "Close" : "Funga")}</button>`;
        endSessionPopup.style.display = "block";
      }
      
      const currentWords = countWords(writeArea.innerText);
      for (let threshold in sessionAchievements) {
        if (currentWords >= threshold && !sessionAchievements[threshold].achieved) {
          sessionAchievements[threshold].achieved = true;
          const achieveElem = document.getElementById("achieve" + threshold);
          if (achieveElem) { achieveElem.textContent = "Erreicht"; }
        }
      }
      const sessionDuration = Math.floor((Date.now() - sessionStartTime) / 1000);
      const xpEarned = currentWords + Math.floor(sessionDuration / 10);
      userStats.xp += xpEarned;
      userStats.totalWords += currentWords;
      if (sessionDuration > userStats.longestSession) { userStats.longestSession = sessionDuration; }
      checkLevelUp();
      saveSessionToLeaderboard();
      updateLeaderboard();
      copyTargetElem.style.display = "none";
      document.getElementById("checkBtn").style.display = "none";
      document.getElementById("copyScoreDisplay").style.display = "none";
      updateProfileUI();
    }
    
    function initBoss() {
      boss = { name: "Wort Boss", maxHealth: 500, currentHealth: 500, targetWords: window.baseTarget * 1.5 };
      bossDefeated = false;
      document.getElementById("bossContainer").style.display = "block";
      document.getElementById("bossName").textContent = boss.name;
      updateBossUI();
    }
    
    function updateBossUI() {
      let healthPercent = (boss.currentHealth / boss.maxHealth) * 100;
      document.getElementById("bossHealth").style.width = healthPercent + "%";
    }
    
    function processNewTextForBossDamage() {
      let fullText = writeArea.innerText;
      let newText = fullText.substring(lastProcessedIndex);
      if (newText.trim().length === 0) return 0;
      let damage = 0;
      let sentenceRegex = /[^\.!\?]+[\.!\?]+/g;
      let sentences = newText.match(sentenceRegex);
      if (!sentences) { sentences = [newText]; }
      sentences.forEach(sentence => {
        let sentenceDamage = 0;
        let words = sentence.trim().split(/\s+/);
        words.forEach(word => {
          let cleanedWord = word.replace(/^[^A-Za-zÄÖÜäöüß'-]+|[^A-Za-zÄÖÜäöüß'-]+$/g, '');
          if (cleanedWord.length > 0) { sentenceDamage += cleanedWord.length; }
        });
        damage += sentenceDamage + Math.round(sentenceDamage * 0.2);
      });
      damage += checkHotStreakBonus();
      lastProcessedIndex = fullText.length;
      return damage;
    }
    
    function updateBossStatus() {
      let newDamage = processNewTextForBossDamage();
      if (newDamage > 0) { boss.currentHealth = Math.max(boss.currentHealth - newDamage, 0); }
      updateBossUI();
      if (boss.currentHealth <= 0 && !bossDefeated) { bossDefeated = true; winGame(); }
    }
    
    function winGame() {
      let bonusXP = 50;
      let bonusWissenspunkte = 50;
      showAchievement(currentLanguage === 'de' ? "Boss besiegt! Bonus XP und Wissenspunkte erhalten!" : (currentLanguage === 'en' ? "Boss defeated! Bonus XP and points awarded!" : "Boss imefanywa! Pokea bonus XP na alama!"));
      userStats.xp += bonusXP;
      userStats.wissenspunkte += bonusWissenspunkte;
      unlockReward("🏆 Boss-Besieger Emoji");
      clearInterval(timerInterval);
      clearTimeout(idleTimeout);
      endSessionPopup.innerHTML = `<h2>${currentLanguage === 'de' ? "Gewonnen! Boss besiegt!" : (currentLanguage === 'en' ? "You Won! Boss Defeated!" : "Umeshinda! Boss imeshindwa!")}</h2>
                                   <p>${currentLanguage === 'de' ? "Bonus XP:" : (currentLanguage === 'en' ? "Bonus XP:" : "Bonus XP:")} ${bonusXP}</p>
                                   <p>${currentLanguage === 'de' ? "Bonus Wissenspunkte:" : (currentLanguage === 'en' ? "Bonus Points:" : "Bonus Alama:")} ${bonusWissenspunkte}</p>
                                   <button onclick="closeResultsPopup()">${currentLanguage === 'de' ? "Schließen" : (currentLanguage === 'en' ? "Close" : "Funga")}</button>`;
      endSessionPopup.style.display = "block";
      updateProfileUI();
    }
    
    function generateAchievements() {
      sessionAchievements = {};
      let threshold = 25;
      while (threshold <= window.baseTarget) {
        sessionAchievements[threshold] = { achieved: false, category: (threshold < 100 ? "Freewrite" : threshold < 200 ? "Copy" : "Allgemein") };
        threshold += 25;
      }
      updateAchievementsTable();
    }
    
    function updateAchievementsTable() {
      const tbody = document.getElementById("achievementBody");
      tbody.innerHTML = "";
      const tier = (difficultySelect.value === "easy") ? "Bronze" : (difficultySelect.value === "normal") ? "Silber" : "Gold";
      const timeMode = parseInt(timeSelect.value);
      const timeLabel = (timeMode === 1) ? "Minute" : "Minuten";
      for (let threshold in sessionAchievements) {
        const ach = sessionAchievements[threshold];
        const row = document.createElement("tr");
        row.setAttribute("data-category", ach.category);
        row.innerHTML = `<td>${timeMode} ${timeLabel}: ${tier} ${threshold}+ Wörter</td>
                         <td>Mindestens ${threshold} Wörter in ${timeMode} ${timeLabel}</td>
                         <td id="achieve${threshold}">${ach.achieved ? "Erreicht" : "Nicht erreicht"}</td>`;
        tbody.appendChild(row);
      }
    }
    
    writeArea.addEventListener("keydown", (e) => {
      if (!sessionActive && waitingForStart && e.key === "Enter") {
         e.preventDefault();
         waitingForStart = false;
         writeArea.innerText = "";
         startSession();
         return;
      }
      if (!sessionActive) return;
      if (modeSelect.value === "copy" && e.key === "Enter") {
         e.preventDefault();
         checkCopySentence();
         return;
      }
      resetIdleTimer();
      updateWordCount();
      keyPressCount++;
      const currentTime = Date.now();
      if (currentTime - lastKeyTime < hotStreakTimeThreshold) { hotStreakCounter++; }
      else { hotStreakCounter = 1; }
      lastKeyTime = currentTime;
      if (hotStreakCounter >= hotStreakRequired) { showHotStreakIndicator(); }
    });
    
// ... bereits vorhandene Event-Listener und Funktionen

// Event-Listener für das Theme-Dropdown
document.getElementById("themeSelect").addEventListener("change", function() {
  // Entferne alle Theme-Klassen vom Body
  document.body.className = "";
  // Füge die ausgewählte Theme-Klasse hinzu
  document.body.classList.add(this.value);
});

// Event-Listener für das Schriftart-Dropdown
document.getElementById("fontSelect").addEventListener("change", function() {
  // Ändert die Schriftart des Bodys
  document.body.style.fontFamily = this.value;
});

// Initiales Rendern
renderShop();
renderInventory();
updateLeaderboard();
updateProfileUI();

  </script>
</body>
</html>
